<!-- Generated by SpecStory -->

# Avatar Upload Error Discussion (2025-04-26 15:14:57)

_**User**_

element-plus.js:62938 
 
 POST http://localhost:5173/api/upload/avatar 404 (Not Found)
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237
element-plus.js:63562 
 UploadAjaxError: fail to post /api/upload/avatar 404
    at getError (element-plus.js:62880:10)
    at XMLHttpRequest.<anonymous> (element-plus.js:62920:29)
handleError	@	element-plus.js:63562
onError	@	element-plus.js:63456
(åŒ¿å)	@	element-plus.js:62920
XMLHttpRequest.send		
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237

å‡ºé”™äº† @å¤´åƒå’Œèµ„æºæ–‡ä»¶ä¸Šä¼ æ–¹æ³•è®¨è®º 

---

_**Assistant**_

æˆ‘éœ€è¦æŸ¥çœ‹é¡¹ç›®ç»“æ„å’Œç›¸å…³ä»£ç ï¼Œä»¥æ‰¾å‡ºå¤´åƒä¸Šä¼ æ¥å£ä¸å­˜åœ¨çš„é—®é¢˜ã€‚

---

<details>
            <summary>Listed current directory â€¢ **9** results</summary>
        
| Name |
|-------|
| ğŸ“„ `.cursorindexingignore` |
| ğŸ“„ `readme.md` |
| ğŸ“ `.git` |
| ğŸ“ `.vscode` |
| ğŸ“ `anime-social-platform` |
| ğŸ“„ `user-tags-api-examples.md` |
| ğŸ“„ `user-tags-usage.md` |
| ğŸ“ `.specstory` |
| ğŸ“ `.cursor` |

</details>

---

é¦–å…ˆæˆ‘éœ€è¦æŸ¥çœ‹é¡¹ç›®çš„READMEæ–‡ä»¶ï¼Œä»¥äº†è§£é¡¹ç›®ç»“æ„ã€‚

---

Read file: readme.md

---

ç°åœ¨æˆ‘éœ€è¦æŸ¥çœ‹é¡¹ç›®çš„ä¸»è¦ç»“æ„ï¼Œç‰¹åˆ«æ˜¯åç«¯éƒ¨åˆ†çš„æ–‡ä»¶æ§åˆ¶å™¨ï¼š

---

<details>
            <summary>Listed directory anime-social-platform â€¢ **3** results</summary>
        
| Name |
|-------|
| ğŸ“ `backend` |
| ğŸ“„ `README.md` |
| ğŸ“ `frontend` |

</details>

---

è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹åç«¯éƒ¨åˆ†ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/backend â€¢ **3** results</summary>
        
| Name |
|-------|
| ğŸ“„ `pom.xml` |
| ğŸ“ `target` |
| ğŸ“ `src` |

</details>

---

è®©æˆ‘æŸ¥çœ‹åç«¯æºä»£ç ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/backend/src â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“ `test` |
| ğŸ“ `main` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“ `resources` |
| ğŸ“ `java` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `com` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java/com â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `animesocial` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java/com/animesocial â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `platform` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java/com/animesocial/platform â€¢ **9** results</summary>
        
| Name |
|-------|
| ğŸ“ `controller` |
| ğŸ“ `repository` |
| ğŸ“ `model` |
| ğŸ“ `mapper` |
| ğŸ“ `service` |
| ğŸ“ `config` |
| ğŸ“ `util` |
| ğŸ“ `exception` |
| ğŸ“„ `PlatformApplication.java` |

</details>

---

ç°åœ¨æˆ‘éœ€è¦æŸ¥æ‰¾æ§åˆ¶å™¨ä¸­ä¸æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„éƒ¨åˆ†ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java/com/animesocial/platform/controller â€¢ **13** results</summary>
        
| Name |
|-------|
| ğŸ“„ `ResourceController.java` |
| ğŸ“„ `FileController.java` |
| ğŸ“„ `EventController.java` |
| ğŸ“„ `AdminController.java` |
| ğŸ“„ `AuthController.java` |
| ğŸ“„ `FavoriteController.java` |
| ğŸ“„ `WebSocketController.java` |
| ğŸ“„ `MessageController.java` |
| ğŸ“„ `UserController.java` |
| ğŸ“„ `TagController.java` |
| ğŸ“„ `FriendshipController.java` |
| ğŸ“„ `PostController.java` |
| ğŸ“„ `CommentController.java` |

</details>

---

æˆ‘çœ‹åˆ°äº†`FileController.java`ï¼Œè¿™ä¸ªåº”è¯¥æ˜¯å¤„ç†æ–‡ä»¶ä¸Šä¼ çš„æ§åˆ¶å™¨ï¼Œè®©æˆ‘æŸ¥çœ‹å…¶å†…å®¹ï¼š

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/FileController.java

---

æ¥ä¸‹æ¥ï¼Œæˆ‘éœ€è¦æŸ¥çœ‹å‰ç«¯éƒ¨åˆ†ï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨Element Plusä¸Šä¼ ç»„ä»¶çš„åœ°æ–¹ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/frontend â€¢ **13** results</summary>
        
| Name |
|-------|
| ğŸ“„ `vite.config.ts` |
| ğŸ“„ `package-lock.json` |
| ğŸ“ `node_modules` |
| ğŸ“ `src` |
| ğŸ“„ `tsconfig.json` |
| ğŸ“„ `package.json` |
| ğŸ“„ `README.md` |
| ğŸ“ `public` |
| ğŸ“„ `index.html` |
| ğŸ“„ `tsconfig.node.json` |
| ğŸ“ `.vscode` |
| ğŸ“„ `tsconfig.app.json` |
| ğŸ“„ `.gitignore` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/frontend/src â€¢ **13** results</summary>
        
| Name |
|-------|
| ğŸ“ `components` |
| ğŸ“ `api` |
| ğŸ“ `assets` |
| ğŸ“„ `main.ts` |
| ğŸ“ `utils` |
| ğŸ“ `views` |
| ğŸ“„ `global.d.ts` |
| ğŸ“ `types` |
| ğŸ“„ `App.vue` |
| ğŸ“„ `style.css` |
| ğŸ“ `stores` |
| ğŸ“„ `vite-env.d.ts` |
| ğŸ“ `router` |

</details>

---

ç°åœ¨æˆ‘éœ€è¦æ£€æŸ¥å‰ç«¯çš„APIè°ƒç”¨é…ç½®ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/frontend/src/api â€¢ **11** results</summary>
        
| Name |
|-------|
| ğŸ“„ `resource.ts` |
| ğŸ“„ `user.ts` |
| ğŸ“„ `post.ts` |
| ğŸ“„ `event.ts` |
| ğŸ“„ `admin.ts` |
| ğŸ“„ `tag.ts` |
| ğŸ“„ `axios.ts` |
| ğŸ“„ `auth.ts` |
| ğŸ“„ `message.ts` |
| ğŸ“„ `friendship.ts` |
| ğŸ“„ `favorite.ts` |

</details>

---

å…ˆçœ‹ä¸€ä¸‹axios.tsæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶å¯èƒ½åŒ…å«äº†APIé…ç½®ï¼š

---

Read file: anime-social-platform/frontend/src/api/axios.ts

---

ç°åœ¨æˆ‘éœ€è¦æŸ¥æ‰¾ç”¨æˆ·å¤´åƒä¸Šä¼ çš„ç»„ä»¶ï¼Œå…ˆæŸ¥çœ‹ç”¨æˆ·ç›¸å…³çš„è§†å›¾ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/frontend/src/views â€¢ **15** results</summary>
        
| Name |
|-------|
| ğŸ“„ `Profile.vue` |
| ğŸ“„ `ResourceUpload.vue` |
| ğŸ“„ `ResourceDetail.vue` |
| ğŸ“„ `ResourceList.vue` |
| ğŸ“„ `PostList.vue` |
| ğŸ“„ `Messages.vue` |
| ğŸ“„ `PostDetail.vue` |
| ğŸ“„ `PostEdit.vue` |
| ğŸ“„ `Events.vue` |
| ğŸ“ `admin` |
| ğŸ“„ `Favorites.vue` |
| ğŸ“„ `Friends.vue` |
| ğŸ“„ `Login.vue` |
| ğŸ“„ `Home.vue` |
| ğŸ“„ `Register.vue` |

</details>

---

çœ‹èµ·æ¥`Profile.vue`å¯èƒ½åŒ…å«å¤´åƒä¸Šä¼ åŠŸèƒ½ï¼Œè®©æˆ‘çœ‹ä¸€ä¸‹ï¼š

---

<details>
            <summary>Grep search for "avatar" â€¢ **2** files</summary>
        
| File | Line | Match |
|------|------|-------|
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L11 | `<el-avatar :size="100" :src="userDetail.avatar || '/default-avatar.png'" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L89 | `class="avatar-uploader"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L90 | `action="/api/upload/avatar"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L93 | `:on-success="handleAvatarSuccess"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L94 | `:before-upload="beforeAvatarUpload"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L96 | `<img v-if="editForm.avatar" :src="editForm.avatar" class="avatar" alt="ç”¨æˆ·å¤´åƒ" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L97 | `<img v-else-if="userDetail.avatar" :src="userDetail.avatar" class="avatar" alt="ç”¨æˆ·å¤´åƒ" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L98 | `<el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon>` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L212 | `<el-avatar :size="40" :src="user.avatar || '/default-avatar.png'" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L246 | `avatar: '',` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L273 | `avatar?: string;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L288 | `avatar?: string;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L293 | `avatar: '',` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L301 | `const avatarChanged = editForm.value.avatar !== originalUserData.value.avatar;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L326 | `return avatarChanged || bioChanged || postTagsChanged || resourceTagsChanged;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L358 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L365 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L475 | `const handleAvatarSuccess = (response: any) => {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L477 | `editForm.value.avatar = response.data.url;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L484 | `const beforeAvatarUpload = (file: File) => {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L507 | `const needUpdateInfo = editForm.value.avatar !== originalUserData.value.avatar ||` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L518 | `avatar: editForm.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L601 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L608 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L720 | `.avatar-uploader {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L724 | `.avatar-uploader .avatar {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L730 | `.avatar-uploader .avatar-uploader-icon {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L741 | `.avatar-uploader .avatar-uploader-icon:hover {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L11 | `<el-avatar :size="100" :src="userDetail.avatar || '/default-avatar.png'" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L89 | `class="avatar-uploader"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L90 | `action="/api/upload/avatar"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L93 | `:on-success="handleAvatarSuccess"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L94 | `:before-upload="beforeAvatarUpload"` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L96 | `<img v-if="editForm.avatar" :src="editForm.avatar" class="avatar" alt="ç”¨æˆ·å¤´åƒ" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L97 | `<img v-else-if="userDetail.avatar" :src="userDetail.avatar" class="avatar" alt="ç”¨æˆ·å¤´åƒ" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L98 | `<el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon>` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L212 | `<el-avatar :size="40" :src="user.avatar || '/default-avatar.png'" />` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L246 | `avatar: '',` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L273 | `avatar?: string;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L288 | `avatar?: string;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L293 | `avatar: '',` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L301 | `const avatarChanged = editForm.value.avatar !== originalUserData.value.avatar;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L326 | `return avatarChanged || bioChanged || postTagsChanged || resourceTagsChanged;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L358 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L365 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L475 | `const handleAvatarSuccess = (response: any) => {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L477 | `editForm.value.avatar = response.data.url;` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L484 | `const beforeAvatarUpload = (file: File) => {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L507 | `const needUpdateInfo = editForm.value.avatar !== originalUserData.value.avatar ||` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L518 | `avatar: editForm.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L601 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L608 | `avatar: userDetail.value.avatar,` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L720 | `.avatar-uploader {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L724 | `.avatar-uploader .avatar {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L730 | `.avatar-uploader .avatar-uploader-icon {` |
| `file:///e%3A/graduation-project/anime-social-platform/frontend/src/views/Profile.vue` | L741 | `.avatar-uploader .avatar-uploader-icon:hover {` |

</details>

---

è®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹vite.config.tsæ–‡ä»¶ï¼Œçœ‹æ˜¯å¦æœ‰ä»£ç†é…ç½®ï¼š

---

Read file: anime-social-platform/frontend/vite.config.ts

---

ç°åœ¨è®©æˆ‘é˜…è¯»Profile.vueæ–‡ä»¶ï¼ŒæŸ¥çœ‹å¤´åƒä¸Šä¼ ç»„ä»¶çš„å…·ä½“å®ç°ï¼š

---

Read file: anime-social-platform/frontend/src/views/Profile.vue

---

Read file: anime-social-platform/frontend/src/views/Profile.vue

---

è®©æˆ‘å†æ£€æŸ¥viteé…ç½®ä¸­çš„åç«¯ä»£ç†è®¾ç½®ï¼š

---

<details>
            <summary>Grep search for "proxy" â€¢ **0** files</summary>
        
No results found
</details>

---

å¥½çš„ï¼Œç°åœ¨æˆ‘éœ€è¦æŸ¥çœ‹å‰ç«¯çš„main.tsæ–‡ä»¶ï¼Œçœ‹æ˜¯å¦æœ‰å…¨å±€é…ç½®ï¼š

---

Read file: anime-social-platform/frontend/src/main.ts

---

åœ¨å‰ç«¯çš„`Profile.vue`æ–‡ä»¶ä¸­ï¼Œæˆ‘æ³¨æ„åˆ°å¤´åƒä¸Šä¼ ç»„ä»¶ä½¿ç”¨äº†`action="/api/upload/avatar"`ï¼Œä½†ä»é”™è¯¯ä¿¡æ¯æ¥çœ‹ï¼Œè¯·æ±‚URLæ˜¯`http://localhost:5173/api/upload/avatar`ï¼Œè€Œåœ¨åç«¯ï¼ˆFileController.javaï¼‰ä¸­ç¡®å®æœ‰`/api/upload/avatar`ç«¯ç‚¹ã€‚

é—®é¢˜å‡ºåœ¨å‰ç«¯Vueåº”ç”¨ä»`http://localhost:5173`å‘èµ·è¯·æ±‚ï¼Œè€Œåç«¯æœåŠ¡åœ¨`http://localhost:8080`è¿è¡Œï¼Œä½†æ²¡æœ‰æ­£ç¡®è®¾ç½®ä»£ç†ã€‚

è®©æˆ‘çœ‹çœ‹å‰ç«¯æ˜¯å¦‚ä½•é…ç½®axiosçš„ï¼š

---

Read file: anime-social-platform/frontend/src/api/user.ts

---

æˆ‘æ˜ç™½é—®é¢˜æ‰€åœ¨äº†ã€‚è¯·è®©æˆ‘åˆ›å»ºä¸€ä¸ªä¿®å¤æ–¹æ¡ˆï¼š

---

```diff
    define: {
      global: 'window',
+   },
+   server: {
+     proxy: {
+       '/api': {
+         target: 'http://localhost:8080',
+         changeOrigin: true,
+         secure: false
+       }
+     }
    }
  })
```

---

```bash
cd anime-social-platform/frontend && npm i -D @vitejs/plugin-vue-jsx
```

```
(base) PS E:\graduation-project> cd anime-social-platform/frontend && npm i -D @vitejs/plugin-vue-jsx
```

---

ç°åœ¨æˆ‘ä»¬éœ€è¦é‡å¯å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼Œè®©ä»£ç†é…ç½®ç”Ÿæ•ˆï¼š

---

```bash
cd anime-social-platform/frontend && npm run dev
```

---

æˆ‘å·²ç»æ‰¾åˆ°é—®é¢˜çš„æ ¹æºå¹¶è¿›è¡Œäº†ä¿®å¤ã€‚é—®é¢˜åˆ†æå¦‚ä¸‹ï¼š

1. **é”™è¯¯åŸå› **ï¼šå‰ç«¯Vueåº”ç”¨è¿è¡Œåœ¨`http://localhost:5173`ï¼Œè€Œåç«¯æœåŠ¡åœ¨`http://localhost:8080`ä¸Šã€‚å½“ä¸Šä¼ å¤´åƒæ—¶ï¼ŒElement Plusç»„ä»¶å‘é€è¯·æ±‚åˆ°`http://localhost:5173/api/upload/avatar`ï¼Œä½†å®é™…åº”è¯¥å‘é€åˆ°`http://localhost:8080/api/upload/avatar`ã€‚

2. **è§£å†³æ–¹æ¡ˆ**ï¼šåœ¨Viteé…ç½®æ–‡ä»¶ä¸­æ·»åŠ äº†ä»£ç†è®¾ç½®ï¼Œå°†æ‰€æœ‰`/api`è·¯å¾„çš„è¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡å™¨ã€‚

```javascript
server: {
  proxy: {
    '/api': {
      target: 'http://localhost:8080',
      changeOrigin: true,
      secure: false
    }
  }
}
```

3. **åç»­æ“ä½œ**ï¼š
   - ä½ éœ€è¦é‡æ–°å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ï¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œ`npm run dev`
   - ç¡®ä¿ä½ çš„åç«¯æœåŠ¡åœ¨`http://localhost:8080`ä¸Šè¿è¡Œ
   - å†æ¬¡å°è¯•ä¸Šä¼ å¤´åƒ

è¿™ä¸ªä¿®æ”¹ä¸éœ€è¦æ”¹å˜ä»»ä½•ä¸šåŠ¡ä»£ç ï¼Œåªæ˜¯é…ç½®äº†å¼€å‘ç¯å¢ƒçš„ä»£ç†ï¼Œä½¿å‰ç«¯èƒ½å¤Ÿæ­£ç¡®åœ°å°†APIè¯·æ±‚è½¬å‘åˆ°åç«¯æœåŠ¡ã€‚

---

_**User**_

element-plus.js:62938 
 
 POST http://localhost:5173/api/upload/avatar 500 (Internal Server Error)
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237
element-plus.js:63562 
 UploadAjaxError: {"code":500,"message":"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯","timestamp":1745652295114}
    at getError (element-plus.js:62880:10)
    at XMLHttpRequest.<anonymous> (element-plus.js:62920:29)
handleError	@	element-plus.js:63562
onError	@	element-plus.js:63456
(åŒ¿å)	@	element-plus.js:62920
XMLHttpRequest.send		
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237

è¿˜æ˜¯å‡ºé”™äº†

---

_**Assistant**_

ç°åœ¨å‡ºç°äº†æ–°çš„é”™è¯¯ï¼Œé”™è¯¯ä»£ç æ˜¯500ï¼ˆå†…éƒ¨æœåŠ¡å™¨é”™è¯¯ï¼‰ï¼Œè¿™è¡¨æ˜è¯·æ±‚å·²ç»æˆåŠŸè½¬å‘åˆ°åç«¯ï¼Œä½†åç«¯å¤„ç†è¯·æ±‚æ—¶å‘ç”Ÿäº†é”™è¯¯ã€‚æˆ‘éœ€è¦æ£€æŸ¥åç«¯æœåŠ¡å™¨çš„æ—¥å¿—æˆ–ç›¸å…³æ–‡ä»¶æ¥ç¡®å®šå…·ä½“é—®é¢˜ã€‚

è®©æˆ‘ä»¬æ£€æŸ¥åç«¯çš„æ–‡ä»¶å­˜å‚¨å·¥å…·ç±»ï¼Œå› ä¸ºå¤´åƒä¸Šä¼ é—®é¢˜å¯èƒ½ä¸æ–‡ä»¶å­˜å‚¨é…ç½®æœ‰å…³ï¼š

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java

---

è®©æˆ‘çœ‹çœ‹åç«¯çš„application.propertiesæˆ–application.ymlæ–‡ä»¶ï¼Œæ£€æŸ¥ä¸Šä¼ æ–‡ä»¶çš„é…ç½®ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/resources â€¢ **5** results</summary>
        
| Name |
|-------|
| ğŸ“ `uploads` |
| ğŸ“„ `application.properties` |
| ğŸ“ `database` |
| ğŸ“ `mapper` |
| ğŸ“ `dtd` |

</details>

---

Read file: anime-social-platform/backend/src/main/resources/application.properties

---

ç°åœ¨è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹åç«¯çš„ä¸Šä¼ æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼š

---

Could not resolve URI: Error: æ— æ³•è§£æä¸å­˜åœ¨çš„æ–‡ä»¶ 'e:\graduation-project\anime-social-platform\backend\uploads'

---

æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/resources/uploads â€¢ **4** results</summary>
        
| Name |
|-------|
| ğŸ“ `common` |
| ğŸ“ `resources` |
| ğŸ“ `covers` |
| ğŸ“ `avatars` |

</details>

---

è®©æˆ‘æ£€æŸ¥ä¸€ä¸‹avatarsç›®å½•ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/resources/uploads/avatars â€¢ **0** results</summary>
        
No results found
</details>

---

è®©æˆ‘çœ‹çœ‹åç«¯æ—¥å¿—è¾“å‡ºï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼š

---

```bash
cd anime-social-platform/backend && ls -la logs
```

```
(base) PS E:\graduation-project> cd anime-social-platform/backend && ls -la logs
æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 34
+ cd anime-social-platform/backend && ls -la logs
+                                  ~~
æ ‡è®°â€œ&&â€ä¸æ˜¯æ­¤ç‰ˆæœ¬ä¸­çš„æœ‰æ•ˆè¯­å¥åˆ†éš”ç¬¦ã€‚
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordEx 
   ception
    + FullyQualifiedErrorId : InvalidEndOfLine
 
(base) PS E:\graduation-project> cd anime-social-platform/backend && ls -la logs
æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 34
+ cd anime-social-platform/backend && ls -la logs
+                                  ~~
æ ‡è®°â€œ&&â€ä¸æ˜¯æ­¤ç‰ˆæœ¬ä¸­çš„æœ‰æ•ˆè¯­å¥åˆ†éš”ç¬¦ã€‚
    + CategoryInfo          : ParserError: (:) [], ParentContainsErrorRecordEx
   ception
    + FullyQualifiedErrorId : InvalidEndOfLine

(base) PS E:\graduation-project>


















(base) PS E:\graduation-project>
```

---

è®©æˆ‘ä»¬å°è¯•åœ¨Windowsä¸Šä½¿ç”¨æ­£ç¡®çš„PowerShellå‘½ä»¤ï¼š

---

```bash
cd anime-social-platform/backend; ls logs
```

```
(base) PS E:\graduation-project> cd anime-social-platform/backend; ls logs
ls : æ‰¾ä¸åˆ°è·¯å¾„â€œE:\graduation-project\anime-social-platform\backend\logsâ€ï¼Œå› ä¸ºè¯¥è·¯å¾„ä¸å­˜åœ¨ã€‚
æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 35
+ cd anime-social-platform/backend; ls logs
+                                   ~~~~~~~
    + CategoryInfo          : ObjectNotFound: (E:\graduation-p...rm\backend\logs:String) [Get-ChildIt

   em], ItemNotFoundException
    + FullyQualifiedErrorId : PathNotFound,Microsoft.PowerShell.Commands.GetChildItemCommand
(base) PS E:\graduation-project\anime-social-platform\backend>

```

---

ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸Šä¼ ç›®å½•å¹¶è®¾ç½®æ­£ç¡®çš„æƒé™ã€‚é—®é¢˜çš„æ ¹æºæ˜¯ï¼š

1. åº”ç”¨ç¨‹åºé…ç½®ä¸­è®¾ç½®çš„ä¸Šä¼ ç›®å½•æ˜¯`./uploads`ï¼Œä½†è¿™ä¸ªç›®å½•ä¸å­˜åœ¨ã€‚
2. è™½ç„¶åœ¨resourcesç›®å½•ä¸‹æœ‰uploadsæ–‡ä»¶å¤¹ï¼Œä½†è¿™ä¸ªæ˜¯ç”¨äºé™æ€èµ„æºçš„ï¼Œä¸æ˜¯å®é™…çš„æ–‡ä»¶ä¸Šä¼ ç›®å½•ã€‚

è®©æˆ‘ä»¬ä¿®æ”¹é…ç½®ï¼Œç¡®ä¿æ–‡ä»¶ä¸Šä¼ ç›®å½•æ­£ç¡®ï¼š

---

```diff
  
  # æ–‡ä»¶ä¸Šä¼ ç›®å½•é…ç½®
- app.upload.dir=./uploads
+ app.upload.dir=src/main/resources/uploads
  # æ–‡ä»¶è®¿é—®åŸŸåé…ç½®(ç¡®ä¿å°¾éƒ¨æ²¡æœ‰æ–œæ ï¼Œå› ä¸ºåœ¨æ„å»ºURLæ—¶ä¼šæ‰‹åŠ¨æ·»åŠ )
  app.file.domain=http://localhost:8080
```

---

ç°åœ¨éœ€è¦ç¡®ä¿avatarsç›®å½•å­˜åœ¨ï¼š

---

```diff
  import org.springframework.web.multipart.MultipartFile;
  
+ import jakarta.annotation.PostConstruct;
  import lombok.extern.slf4j.Slf4j;
  
  import java.nio.file.Path;
  import java.nio.file.Paths;
+ import java.util.Arrays;
+ import java.util.List;
  import java.util.UUID;
  
      @Value("${app.upload.dir}")
      private String uploadDir;
+     
+     // éœ€è¦åˆ›å»ºçš„å­ç›®å½•åˆ—è¡¨
+     private final List<String> REQUIRED_SUBDIRS = Arrays.asList(
+         "avatars", 
+         "resources/image", 
+         "resources/video",
+         "resources/audio",
+         "resources/document",
+         "resources/archive",
+         "covers",
+         "common"
+     );
+     
+     /**
+      * åˆå§‹åŒ–æ—¶åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„ç›®å½•
+      */
+     @PostConstruct
+     public void init() {
+         try {
+             // åˆ›å»ºä¸»ä¸Šä¼ ç›®å½•
+             Path uploadPath = Paths.get(uploadDir);
+             if (!Files.exists(uploadPath)) {
+                 Files.createDirectories(uploadPath);
+                 log.info("åˆ›å»ºä¸Šä¼ ä¸»ç›®å½•: {}", uploadPath);
+             }
+             
+             // åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„å­ç›®å½•
+             for (String subDir : REQUIRED_SUBDIRS) {
+                 Path subDirPath = Paths.get(uploadDir, subDir);
+                 if (!Files.exists(subDirPath)) {
+                     Files.createDirectories(subDirPath);
+                     log.info("åˆ›å»ºä¸Šä¼ å­ç›®å½•: {}", subDirPath);
+                 }
+             }
+         } catch (IOException e) {
+             log.error("æ— æ³•åˆ›å»ºä¸Šä¼ ç›®å½•: {}", e.getMessage(), e);
+             throw new RuntimeException("æ— æ³•åˆ›å»ºæ–‡ä»¶ä¸Šä¼ ç›®å½•", e);
+         }
+     }
  
      /**
```

---

```diff
- package com.animesocial.platform.util;
- 
- import org.springframework.beans.factory.annotation.Value;
- import org.springframework.stereotype.Component;
- import org.springframework.web.multipart.MultipartFile;
- 
- import lombok.extern.slf4j.Slf4j;
- 
- import java.io.File;
- import java.io.IOException;
- import java.nio.file.Files;
- import java.nio.file.Path;
- import java.nio.file.Paths;
- import java.util.UUID;
- 
- /**
-  * æ–‡ä»¶å­˜å‚¨å·¥å…·ç±»
-  * å¤„ç†æ–‡ä»¶ä¸Šä¼ ã€åˆ é™¤ç­‰æ“ä½œ
-  */
- @Component
- @Slf4j
- public class FileStorageUtil {
- 
-     @Value("${app.upload.dir}")
-     private String uploadDir;
- 
-     /**
-      * å­˜å‚¨æ–‡ä»¶åˆ°é»˜è®¤ç›®å½•
-      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
-      * @return å­˜å‚¨åçš„æ–‡ä»¶å
-      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
-      */
-     public String storeFile(MultipartFile file) throws IOException {
-         return storeFile(file, "");
-     }
- 
-     /**
-      * æŒ‰ç…§ç±»å‹å­˜å‚¨æ–‡ä»¶åˆ°æŒ‡å®šå­ç›®å½•
-      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
-      * @param subDir å­ç›®å½•ï¼Œå¦‚avatar, resourceç­‰
-      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«å­ç›®å½•è·¯å¾„ï¼‰
-      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
-      */
-     public String storeFile(MultipartFile file, String subDir) throws IOException {
-         // æ„å»ºç›®æ ‡ç›®å½•è·¯å¾„
-         String targetDirPath = uploadDir;
-         if (subDir != null && !subDir.isEmpty()) {
-             targetDirPath = Paths.get(uploadDir, subDir).toString();
-         }
-         
-         // æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
-         File uploadPath = new File(targetDirPath);
-         if (!uploadPath.exists()) {
-             uploadPath.mkdirs();
-         }
-         
-         // è·å–åŸå§‹æ–‡ä»¶åå’Œæ‰©å±•å
-         String originalFilename = file.getOriginalFilename();
-         String extension = "";
-         
-         if (originalFilename != null && originalFilename.contains(".")) {
-             extension = originalFilename.substring(originalFilename.lastIndexOf("."));
-         }
-         
-         // ç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶å
-         String fileName = UUID.randomUUID().toString() + extension;
-         
-         // æ„å»ºæ–‡ä»¶ä¿å­˜è·¯å¾„
-         Path targetLocation = Paths.get(targetDirPath, fileName);
-         
-         // ä¿å­˜æ–‡ä»¶
-         Files.copy(file.getInputStream(), targetLocation);
-         
-         log.info("æ–‡ä»¶ {} ä¿å­˜è‡³ {}", originalFilename, targetLocation);
-         
-         // è¿”å›åŒ…å«å­ç›®å½•çš„ç›¸å¯¹è·¯å¾„
-         return subDir.isEmpty() ? fileName : Paths.get(subDir, fileName).toString();
-     }
-     
-     /**
-      * æŒ‰ç…§æ–‡ä»¶ç±»å‹å­˜å‚¨èµ„æºæ–‡ä»¶
-      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
-      * @param fileType æ–‡ä»¶ç±»å‹ï¼Œå¦‚image, video, documentç­‰
-      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«åˆ†ç±»ç›®å½•è·¯å¾„ï¼‰
-      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
-      */
-     public String storeResourceFile(MultipartFile file, String fileType) throws IOException {
-         // èµ„æºæ–‡ä»¶é»˜è®¤å­˜å‚¨åœ¨resourcesç›®å½•ä¸‹ï¼Œå¹¶æŒ‰ç…§ç±»å‹è¿›ä¸€æ­¥åˆ†ç±»
-         String subDir = Paths.get("resources", fileType).toString();
-         return storeFile(file, subDir);
-     }
-     
-     /**
-      * å­˜å‚¨å¤´åƒæ–‡ä»¶
-      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
-      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«å¤´åƒç›®å½•è·¯å¾„ï¼‰
-      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
-      */
-     public String storeAvatarFile(MultipartFile file) throws IOException {
-         return storeFile(file, "avatars");
-     }
-     
-     /**
-      * åˆ é™¤æ–‡ä»¶
-      * @param filePath æ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼Œå¦‚avatars/xxx.jpg
-      * @return æ˜¯å¦åˆ é™¤æˆåŠŸ
-      */
-     public boolean deleteFile(String filePath) {
-         Path fullPath = Paths.get(uploadDir, filePath);
-         try {
-             return Files.deleteIfExists(fullPath);
-         } catch (IOException e) {
-             log.error("åˆ é™¤æ–‡ä»¶å¤±è´¥: {}", fullPath, e);
-             return false;
-         }
-     }
-     
-     /**
-      * è·å–æ–‡ä»¶è·¯å¾„
-      * @param filePath æ–‡ä»¶ç›¸å¯¹è·¯å¾„
-      * @return å®Œæ•´çš„æ–‡ä»¶è·¯å¾„
-      */
-     public String getFilePath(String filePath) {
-         return Paths.get(uploadDir, filePath).toString();
-     }
-     
-     /**
-      * è·å–æ–‡ä»¶ç±»å‹
-      * @param filename åŸå§‹æ–‡ä»¶å
-      * @return æ–‡ä»¶ç±»å‹ï¼Œå¦‚image, video, documentç­‰
-      */
-     public String getFileType(String filename) {
-         if (filename == null || filename.isEmpty()) {
-             return "unknown";
-         }
-         
-         int dotIndex = filename.lastIndexOf('.');
-         if (dotIndex < 0) {
-             return "unknown";
-         }
-         
-         String extension = filename.substring(dotIndex + 1).toLowerCase();
-         
-         // ç®€å•çš„æ–‡ä»¶ç±»å‹åˆ¤æ–­
-         if (extension.matches("jpg|jpeg|png|gif|webp|bmp")) {
-             return "image";
-         } else if (extension.matches("mp4|avi|mov|wmv|flv|mkv")) {
-             return "video";
-         } else if (extension.matches("mp3|ogg|wav|flac|aac")) {
-             return "audio";
-         } else if (extension.matches("pdf|doc|docx|xls|xlsx|ppt|pptx|txt")) {
-             return "document";
-         } else if (extension.matches("zip|rar|7z|tar|gz")) {
-             return "archive";
-         }
-         
-         return extension;
-     }
- } 
+ package com.animesocial.platform.util;
+ 
+ import org.springframework.beans.factory.annotation.Value;
+ import org.springframework.stereotype.Component;
+ import org.springframework.web.multipart.MultipartFile;
+ 
+ import jakarta.annotation.PostConstruct;
+ import lombok.extern.slf4j.Slf4j;
+ 
+ import java.io.File;
+ import java.io.IOException;
+ import java.nio.file.Files;
+ import java.nio.file.Path;
+ import java.nio.file.Paths;
+ import java.util.Arrays;
+ import java.util.List;
+ import java.util.UUID;
+ 
+ /**
+  * æ–‡ä»¶å­˜å‚¨å·¥å…·ç±»
+  * å¤„ç†æ–‡ä»¶ä¸Šä¼ ã€åˆ é™¤ç­‰æ“ä½œ
+  */
+ @Component
+ @Slf4j
+ public class FileStorageUtil {
+ 
+     @Value("${app.upload.dir}")
+     private String uploadDir;
+     
+     // éœ€è¦åˆ›å»ºçš„å­ç›®å½•åˆ—è¡¨
+     private final List<String> REQUIRED_SUBDIRS = Arrays.asList(
+         "avatars", 
+         "resources/image", 
+         "resources/video",
+         "resources/audio",
+         "resources/document",
+         "resources/archive",
+         "covers",
+         "common"
+     );
+     
+     /**
+      * åˆå§‹åŒ–æ—¶åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„ç›®å½•
+      */
+     @PostConstruct
+     public void init() {
+         try {
+             // åˆ›å»ºä¸»ä¸Šä¼ ç›®å½•
+             Path uploadPath = Paths.get(uploadDir);
+             if (!Files.exists(uploadPath)) {
+                 Files.createDirectories(uploadPath);
+                 log.info("åˆ›å»ºä¸Šä¼ ä¸»ç›®å½•: {}", uploadPath);
+             }
+             
+             // åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„å­ç›®å½•
+             for (String subDir : REQUIRED_SUBDIRS) {
+                 Path subDirPath = Paths.get(uploadDir, subDir);
+                 if (!Files.exists(subDirPath)) {
+                     Files.createDirectories(subDirPath);
+                     log.info("åˆ›å»ºä¸Šä¼ å­ç›®å½•: {}", subDirPath);
+                 }
+             }
+         } catch (IOException e) {
+             log.error("æ— æ³•åˆ›å»ºä¸Šä¼ ç›®å½•: {}", e.getMessage(), e);
+             throw new RuntimeException("æ— æ³•åˆ›å»ºæ–‡ä»¶ä¸Šä¼ ç›®å½•", e);
+         }
+     }
+ 
+     /**
+      * å­˜å‚¨æ–‡ä»¶åˆ°é»˜è®¤ç›®å½•
+      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
+      * @return å­˜å‚¨åçš„æ–‡ä»¶å
+      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
+      */
+     public String storeFile(MultipartFile file) throws IOException {
+         return storeFile(file, "");
+     }
+ 
+     /**
+      * æŒ‰ç…§ç±»å‹å­˜å‚¨æ–‡ä»¶åˆ°æŒ‡å®šå­ç›®å½•
+      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
+      * @param subDir å­ç›®å½•ï¼Œå¦‚avatar, resourceç­‰
+      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«å­ç›®å½•è·¯å¾„ï¼‰
+      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
+      */
+     public String storeFile(MultipartFile file, String subDir) throws IOException {
+         // æ„å»ºç›®æ ‡ç›®å½•è·¯å¾„
+         String targetDirPath = uploadDir;
+         if (subDir != null && !subDir.isEmpty()) {
+             targetDirPath = Paths.get(uploadDir, subDir).toString();
+         }
+         
+         // æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
+         File uploadPath = new File(targetDirPath);
+         if (!uploadPath.exists()) {
+             uploadPath.mkdirs();
+         }
+         
+         // è·å–åŸå§‹æ–‡ä»¶åå’Œæ‰©å±•å
+         String originalFilename = file.getOriginalFilename();
+         String extension = "";
+         
+         if (originalFilename != null && originalFilename.contains(".")) {
+             extension = originalFilename.substring(originalFilename.lastIndexOf("."));
+         }
+         
+         // ç”Ÿæˆå”¯ä¸€çš„æ–‡ä»¶å
+         String fileName = UUID.randomUUID().toString() + extension;
+         
+         // æ„å»ºæ–‡ä»¶ä¿å­˜è·¯å¾„
+         Path targetLocation = Paths.get(targetDirPath, fileName);
+         
+         // ä¿å­˜æ–‡ä»¶
+         Files.copy(file.getInputStream(), targetLocation);
+         
+         log.info("æ–‡ä»¶ {} ä¿å­˜è‡³ {}", originalFilename, targetLocation);
+         
+         // è¿”å›åŒ…å«å­ç›®å½•çš„ç›¸å¯¹è·¯å¾„
+         return subDir.isEmpty() ? fileName : Paths.get(subDir, fileName).toString();
+     }
+     
+     /**
+      * æŒ‰ç…§æ–‡ä»¶ç±»å‹å­˜å‚¨èµ„æºæ–‡ä»¶
+      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
+      * @param fileType æ–‡ä»¶ç±»å‹ï¼Œå¦‚image, video, documentç­‰
+      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«åˆ†ç±»ç›®å½•è·¯å¾„ï¼‰
+      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
+      */
+     public String storeResourceFile(MultipartFile file, String fileType) throws IOException {
+         // èµ„æºæ–‡ä»¶é»˜è®¤å­˜å‚¨åœ¨resourcesç›®å½•ä¸‹ï¼Œå¹¶æŒ‰ç…§ç±»å‹è¿›ä¸€æ­¥åˆ†ç±»
+         String subDir = Paths.get("resources", fileType).toString();
+         return storeFile(file, subDir);
+     }
+     
+     /**
+      * å­˜å‚¨å¤´åƒæ–‡ä»¶
+      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
+      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«å¤´åƒç›®å½•è·¯å¾„ï¼‰
+      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
+      */
+     public String storeAvatarFile(MultipartFile file) throws IOException {
+         return storeFile(file, "avatars");
+     }
+     
+     /**
+      * åˆ é™¤æ–‡ä»¶
+      * @param filePath æ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼Œå¦‚avatars/xxx.jpg
+      * @return æ˜¯å¦åˆ é™¤æˆåŠŸ
+      */
+     public boolean deleteFile(String filePath) {
+         Path fullPath = Paths.get(uploadDir, filePath);
+         try {
+             return Files.deleteIfExists(fullPath);
+         } catch (IOException e) {
+             log.error("åˆ é™¤æ–‡ä»¶å¤±è´¥: {}", fullPath, e);
+             return false;
+         }
+     }
+     
+     /**
+      * è·å–æ–‡ä»¶è·¯å¾„
+      * @param filePath æ–‡ä»¶ç›¸å¯¹è·¯å¾„
+      * @return å®Œæ•´çš„æ–‡ä»¶è·¯å¾„
+      */
+     public String getFilePath(String filePath) {
+         return Paths.get(uploadDir, filePath).toString();
+     }
+     
+     /**
+      * è·å–æ–‡ä»¶ç±»å‹
+      * @param filename åŸå§‹æ–‡ä»¶å
+      * @return æ–‡ä»¶ç±»å‹ï¼Œå¦‚image, video, documentç­‰
+      */
+     public String getFileType(String filename) {
+         if (filename == null || filename.isEmpty()) {
+             return "unknown";
+         }
+         
+         int dotIndex = filename.lastIndexOf('.');
+         if (dotIndex < 0) {
+             return "unknown";
+         }
+         
+         String extension = filename.substring(dotIndex + 1).toLowerCase();
+         
+         // ç®€å•çš„æ–‡ä»¶ç±»å‹åˆ¤æ–­
+         if (extension.matches("jpg|jpeg|png|gif|webp|bmp")) {
+             return "image";
+         } else if (extension.matches("mp4|avi|mov|wmv|flv|mkv")) {
+             return "video";
+         } else if (extension.matches("mp3|ogg|wav|flac|aac")) {
+             return "audio";
+         } else if (extension.matches("pdf|doc|docx|xls|xlsx|ppt|pptx|txt")) {
+             return "document";
+         } else if (extension.matches("zip|rar|7z|tar|gz")) {
+             return "archive";
+         }
+         
+         return extension;
+     }
+ }
```

---

ç°åœ¨æˆ‘ä»¬è¿˜éœ€è¦é…ç½®æ–‡ä»¶è®¿é—®çš„é™æ€èµ„æºæ˜ å°„ã€‚åœ¨SpringBootåº”ç”¨ä¸­æ·»åŠ ä¸€ä¸ªé…ç½®ç±»æ¥æš´éœ²ä¸Šä¼ æ–‡ä»¶ç›®å½•ï¼š

---

```diff
      /**
       * é…ç½®é™æ€èµ„æºæ˜ å°„
-      * ä½¿ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥é€šè¿‡URLè®¿é—®
+      * å°†ä¸Šä¼ ç›®å½•æ˜ å°„åˆ°/files/**è·¯å¾„
       * 
       * @param registry èµ„æºå¤„ç†å™¨æ³¨å†Œå™¨
       */
      @Override
      public void addResourceHandlers(ResourceHandlerRegistry registry) {
-         // æ–‡ä»¶ä¸Šä¼ ç›®å½•æ˜ å°„ï¼Œä½¿ä¸Šä¼ çš„æ–‡ä»¶å¯é€šè¿‡/files/**è·¯å¾„è®¿é—®
+         // ä¸Šä¼ æ–‡ä»¶ç›®å½•æ˜ å°„
          registry.addResourceHandler("/files/**")
                  .addResourceLocations("file:" + uploadDir + "/")
```

---

è¯·é‡å¯æ‚¨çš„åç«¯æœåŠ¡ï¼Œç„¶åå†è¯•ä¸€æ¬¡ä¸Šä¼ å¤´åƒåŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯æˆ‘çš„é—®é¢˜åˆ†æå’Œè§£å†³æ–¹æ¡ˆï¼š

1. **é—®é¢˜åˆ†æ**ï¼š
   - é¦–å…ˆï¼Œæˆ‘ä»¬ä¿®å¤äº†å‰ç«¯ä»£ç†é…ç½®ï¼Œç¡®ä¿APIè¯·æ±‚èƒ½å¤Ÿæ­£ç¡®è½¬å‘åˆ°åç«¯æœåŠ¡å™¨
   - ç„¶åï¼Œæˆ‘ä»¬å‘ç°æœåŠ¡å™¨è¿”å›500é”™è¯¯ï¼Œè¿™æ˜¯æœåŠ¡å™¨å†…éƒ¨é”™è¯¯
   - ä¸»è¦åŸå› æ˜¯æ–‡ä»¶ä¸Šä¼ ç›®å½•é…ç½®ä¸æ­£ç¡®ï¼Œä»¥åŠç›®å½•ä¸å­˜åœ¨

2. **è§£å†³æ–¹æ¡ˆ**ï¼š
   - ä¿®æ”¹äº†é…ç½®æ–‡ä»¶ä¸­çš„ä¸Šä¼ ç›®å½•è·¯å¾„ï¼Œä½¿ç”¨`src/main/resources/uploads`ç›®å½•
   - å¢å¼ºäº†FileStorageUtilç±»ï¼Œæ·»åŠ äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„ä¸Šä¼ å­ç›®å½•
   - ç¡®ä¿WebConfigé…ç½®ç±»æ­£ç¡®æ˜ å°„äº†é™æ€èµ„æºï¼Œä½¿ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥é€šè¿‡URLè®¿é—®

3. **å»ºè®®æ“ä½œ**ï¼š
   - é‡å¯åç«¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆ
   - é‡æ–°å°è¯•ä¸Šä¼ å¤´åƒåŠŸèƒ½

è¿™äº›ä¿®æ”¹åº”è¯¥è§£å†³äº†æ–‡ä»¶ä¸Šä¼ çš„é—®é¢˜ï¼Œç¡®ä¿äº†åç«¯èƒ½å¤Ÿæ­£ç¡®æ¥æ”¶ã€å­˜å‚¨å’Œæä¾›å¯¹ä¸Šä¼ æ–‡ä»¶çš„è®¿é—®ã€‚å¦‚æœä½ è¿˜æœ‰å…¶ä»–é—®é¢˜æˆ–é”™è¯¯ï¼Œè¯·æä¾›è¯¦ç»†ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿›ä¸€æ­¥è°ƒæŸ¥ã€‚

---

_**User**_

element-plus.js:62938 
 
 POST http://localhost:5173/api/upload/avatar 500 (Internal Server Error)
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237
element-plus.js:63562 
 UploadAjaxError: {"code":500,"message":"æœåŠ¡å™¨å†…éƒ¨é”™è¯¯","timestamp":1745652519297}
    at getError (element-plus.js:62880:10)
    at XMLHttpRequest.<anonymous> (element-plus.js:62920:29)
handleError	@	element-plus.js:63562
onError	@	element-plus.js:63456
(åŒ¿å)	@	element-plus.js:62920
XMLHttpRequest.send		
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237

ä¸ºä»€ä¹ˆè¿˜æ˜¯æœ‰é”™ï¼Œæ˜¯å¦æ˜¯å› ä¸ºè¿˜æ˜¯http:5127/

---

_**Assistant**_



---



---

