<!-- Generated by SpecStory -->

# å¤´åƒå’Œèµ„æºæ–‡ä»¶ä¸Šä¼ æ–¹æ³•è®¨è®º (2025-04-26 14:10:12)

_**User**_

è¿™ä¸ªé¡¹ç›®æˆ‘è¯¥å¦‚ä½•ä¸Šä¼ å¤´åƒå›¾ç‰‡ä»¥åŠèµ„æºæ–‡ä»¶ï¼Œè¯·æ‚¨ä»”ç»†æ€è€ƒï¼Œç»™å‡ºä¸€ä¸ªåˆç†ï¼Œç®€å•ï¼Œç¬¦åˆå½“å‰é¡¹ç›®çš„æ–¹æ³•

---

_**Assistant**_

æˆ‘å°†å¸®æ‚¨è§£å†³ä¸Šä¼ å¤´åƒå’Œèµ„æºæ–‡ä»¶çš„é—®é¢˜ã€‚é¦–å…ˆï¼Œè®©æˆ‘äº†è§£ä¸€ä¸‹å½“å‰é¡¹ç›®çš„ç»“æ„å’ŒæŠ€æœ¯æ ˆã€‚

---

<details>
            <summary>Listed current directory â€¢ **10** results</summary>
        
| Name |
|-------|
| ğŸ“„ `readme.md` |
| ğŸ“ `src` |
| ğŸ“ `.git` |
| ğŸ“ `.vscode` |
| ğŸ“ `anime-social-platform` |
| ğŸ“„ `user-tags-api-examples.md` |
| ğŸ“„ `user-tags-usage.md` |
| ğŸ“„ `.cursorindexingignore` |
| ğŸ“ `.specstory` |
| ğŸ“ `.cursor` |

</details>

---

è®©æˆ‘å…ˆæŸ¥çœ‹readme.mdæ–‡ä»¶ï¼Œäº†è§£é¡¹ç›®å†…å®¹ï¼š

---

Read file: readme.md

---

ç°åœ¨è®©æˆ‘çœ‹çœ‹é¡¹ç›®çš„ä»£ç ç»“æ„ï¼š

---

<details>
            <summary>Listed directory src â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `views` |

</details>

---

<details>
            <summary>Listed directory src/views â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `posts` |

</details>

---

è®©æˆ‘æŸ¥çœ‹ä¸‹é¡¹ç›®çš„å…¶ä»–ç›®å½•ç»“æ„ï¼š

---

<details>
            <summary>Listed directory anime-social-platform â€¢ **3** results</summary>
        
| Name |
|-------|
| ğŸ“ `backend` |
| ğŸ“„ `README.md` |
| ğŸ“ `frontend` |

</details>

---

æˆ‘éœ€è¦æŸ¥çœ‹ä¸€ä¸‹å‰åç«¯çš„å…·ä½“ç»“æ„ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/frontend â€¢ **13** results</summary>
        
| Name |
|-------|
| ğŸ“„ `package-lock.json` |
| ğŸ“ `node_modules` |
| ğŸ“ `src` |
| ğŸ“„ `tsconfig.json` |
| ğŸ“„ `package.json` |
| ğŸ“„ `README.md` |
| ğŸ“„ `vite.config.ts` |
| ğŸ“ `public` |
| ğŸ“„ `index.html` |
| ğŸ“„ `tsconfig.node.json` |
| ğŸ“ `.vscode` |
| ğŸ“„ `tsconfig.app.json` |
| ğŸ“„ `.gitignore` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend â€¢ **3** results</summary>
        
| Name |
|-------|
| ğŸ“„ `pom.xml` |
| ğŸ“ `target` |
| ğŸ“ `src` |

</details>

---

è®©æˆ‘çœ‹çœ‹å‰ç«¯çš„srcç›®å½•ç»“æ„ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/frontend/src â€¢ **13** results</summary>
        
| Name |
|-------|
| ğŸ“ `components` |
| ğŸ“ `api` |
| ğŸ“ `assets` |
| ğŸ“„ `main.ts` |
| ğŸ“ `utils` |
| ğŸ“ `views` |
| ğŸ“„ `global.d.ts` |
| ğŸ“ `types` |
| ğŸ“„ `App.vue` |
| ğŸ“„ `style.css` |
| ğŸ“ `stores` |
| ğŸ“„ `vite-env.d.ts` |
| ğŸ“ `router` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/frontend/src/assets â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“ `icons` |
| ğŸ“„ `vue.svg` |

</details>

---

ç°åœ¨æˆ‘éœ€è¦æŸ¥çœ‹åç«¯çš„ä»£ç ç»“æ„ï¼Œç‰¹åˆ«æ˜¯æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„ä»£ç ï¼š

---

<details>
            <summary>Listed directory anime-social-platform/backend/src â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“ `test` |
| ğŸ“ `main` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“ `resources` |
| ğŸ“ `java` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `com` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java/com â€¢ **2** results</summary>
        
| Name |
|-------|
| ğŸ“ `ruoyi` |
| ğŸ“ `animesocial` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java/com/animesocial â€¢ **1** results</summary>
        
| Name |
|-------|
| ğŸ“ `platform` |

</details>

---

<details>
            <summary>Listed directory anime-social-platform/backend/src/main/java/com/animesocial/platform â€¢ **9** results</summary>
        
| Name |
|-------|
| ğŸ“ `repository` |
| ğŸ“ `model` |
| ğŸ“ `mapper` |
| ğŸ“ `controller` |
| ğŸ“ `service` |
| ğŸ“ `config` |
| ğŸ“ `util` |
| ğŸ“ `exception` |
| ğŸ“„ `PlatformApplication.java` |

</details>

---

è®©æˆ‘çœ‹çœ‹æ˜¯å¦æœ‰æ–‡ä»¶ä¸Šä¼ ç›¸å…³çš„æ§åˆ¶å™¨æˆ–å·¥å…·ç±»ï¼š

---

<details>
            <summary>Searched codebase "file upload controller" â€¢ **23** results</summary>
        
| File | Lines |
|------|-------|
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L1-66 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L36-71 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L86-116 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L165-210 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L371-393 |
| `anime-social-platform/frontend/src/api/resource.ts` | L47-60 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L272-371 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L210-272 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L1-36 |
| `anime-social-platform/backend/target/classes/application.properties` | L1-37 |
| `anime-social-platform/backend/src/main/resources/application.properties` | L1-37 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L66-85 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L138-210 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L71-138 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L50-86 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L1-50 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/ResourceService.java` | L1-73 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L360-403 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L210-256 |
| `anime-social-platform/frontend/src/api/resource.ts` | L60-74 |
| `anime-social-platform/frontend/src/views/admin/ResourceManagement.vue` | L579-652 |
| `anime-social-platform/frontend/src/views/admin/ResourceManagement.vue` | L204-259 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L83-114 |

</details>

---

<details>
            <summary>Searched codebase "user profile avatar upload" â€¢ **25** results</summary>
        
| File | Lines |
|------|-------|
| `anime-social-platform/frontend/src/views/Profile.vue` | L83-114 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L439-499 |
| `anime-social-platform/frontend/src/api/user.ts` | L35-44 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L499-545 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L36-71 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L165-210 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/model/dto/UpdateUserInfoRequest.java` | L1-25 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L371-393 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L271-333 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L617-776 |
| `anime-social-platform/frontend/src/types/auth.ts` | L12-21 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L1-66 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L272-371 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L545-617 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L333-391 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L1-56 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L138-210 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L86-116 |
| `anime-social-platform/frontend/src/api/resource.ts` | L47-60 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L1-36 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L210-272 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L39-111 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L71-138 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/UserServiceImpl.java` | L367-428 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/model/User.java` | L1-52 |

</details>

---

<details>
            <summary>Searched codebase "FileController upload" â€¢ **23** results</summary>
        
| File | Lines |
|------|-------|
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L1-66 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L165-210 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L86-116 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L36-71 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L66-85 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L210-272 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L272-371 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L1-36 |
| `anime-social-platform/frontend/src/api/resource.ts` | L47-60 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L138-210 |
| `anime-social-platform/backend/target/classes/application.properties` | L1-37 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L371-393 |
| `anime-social-platform/backend/src/main/resources/application.properties` | L1-37 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L71-138 |
| `anime-social-platform/frontend/src/views/admin/ResourceManagement.vue` | L579-652 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L1-50 |
| `anime-social-platform/frontend/src/views/admin/ResourceManagement.vue` | L204-259 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L50-86 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L360-403 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L210-256 |
| `anime-social-platform/frontend/src/views/ResourceDetail.vue` | L223-277 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/ResourceService.java` | L1-73 |
| `anime-social-platform/frontend/src/views/admin/ResourceManagement.vue` | L65-115 |

</details>

---

<details>
            <summary>Searched codebase "FileController.java" â€¢ **13** results</summary>
        
| File | Lines |
|------|-------|
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L1-66 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L66-85 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L1-50 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L165-210 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L86-116 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L360-403 |
| `anime-social-platform/backend/target/maven-status/maven-compiler-plugin/compile/default-compile/inputFiles.lst` | L1-84 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L50-86 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L1-39 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/model/Resource.java` | L1-67 |
| `anime-social-platform/backend/target/maven-status/maven-compiler-plugin/compile/default-compile/createdFiles.lst` | L1-85 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/FriendshipController.java` | L1-27 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/UserController.java` | L1-25 |

</details>

---

<details>
            <summary>Searched codebase "FileController.java" â€¢ **10** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

<details>
            <summary>Searched codebase "FileController" â€¢ **10** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |
| `undefined` |

</details>

---

<details>
            <summary>Searched codebase "upload avatar" â€¢ **23** results</summary>
        
| File | Lines |
|------|-------|
| `anime-social-platform/frontend/src/views/Profile.vue` | L83-114 |
| `anime-social-platform/frontend/src/api/user.ts` | L35-44 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L439-499 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L36-71 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/model/dto/UpdateUserInfoRequest.java` | L1-25 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L371-393 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L165-210 |
| `anime-social-platform/frontend/src/api/resource.ts` | L47-60 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L272-371 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L1-66 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L210-272 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/ResourceController.java` | L86-116 |
| `anime-social-platform/frontend/src/types/auth.ts` | L12-21 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L138-210 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L71-138 |
| `anime-social-platform/frontend/src/api/resource.ts` | L60-74 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L499-545 |
| `anime-social-platform/backend/target/classes/application.properties` | L1-37 |
| `anime-social-platform/backend/src/main/resources/application.properties` | L1-37 |
| `anime-social-platform/frontend/src/views/ResourceUpload.vue` | L1-36 |
| `anime-social-platform/frontend/src/views/Profile.vue` | L271-333 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java` | L66-85 |
| `anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java` | L39-111 |

</details>

---

è®©æˆ‘çœ‹çœ‹UserControlleræ˜¯å¦åŒ…å«ä¸Šä¼ å¤´åƒçš„å¤„ç†ï¼š

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/controller/UserController.java

---

é€šè¿‡ä»¥ä¸Šæ£€ç´¢ï¼Œæˆ‘å‘ç°é¡¹ç›®ç¼ºå°‘äº†ä¸€ä¸ªä¸“é—¨çš„æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼ˆå¦‚FileControllerï¼‰ã€‚è€Œé€šè¿‡å¯¹ä»£ç è¿›è¡Œåˆ†æï¼Œæˆ‘äº†è§£åˆ°ï¼š

1. é¡¹ç›®ä¸­å·²æœ‰`FileStorageUtil`å·¥å…·ç±»è´Ÿè´£æ–‡ä»¶å­˜å‚¨å®ç°
2. èµ„æºä¸Šä¼ ä½¿ç”¨äº†`ResourceController`ä¸­çš„æ¥å£
3. ç”¨æˆ·å¤´åƒç›¸å…³çš„åŠŸèƒ½åœ¨`UserController`é‡Œæœ‰æ›´æ–°ï¼Œä½†ç¼ºå°‘ä¸“é—¨çš„ä¸Šä¼ æ¥å£
4. å‰ç«¯çš„Profile.vueé‡Œæœ‰å¤´åƒä¸Šä¼ ç»„ä»¶ï¼Œä½†actionæŒ‡å‘äº†"/api/upload"è¿™ä¸ªæ¥å£ï¼Œè€Œåå°ç¼ºå°‘è¿™ä¸ªæ¥å£çš„å®ç°

ä¸‹é¢æˆ‘å°†ä¸ºæ‚¨è®¾è®¡ä¸€ä¸ªç¬¦åˆå½“å‰é¡¹ç›®æ¶æ„çš„æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆï¼š

### æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆ

1. åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„`FileController`æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼ŒåŒ…æ‹¬å¤´åƒå’Œå…¶ä»–èµ„æºæ–‡ä»¶
2. ä½¿ç”¨å·²æœ‰çš„`FileStorageUtil`å·¥å…·ç±»å®ç°æ–‡ä»¶å­˜å‚¨
3. æä¾›ç»Ÿä¸€çš„æ¥å£æ¥å¤„ç†ä¸åŒç±»å‹çš„æ–‡ä»¶ä¸Šä¼ 

å…·ä½“å®ç°æ­¥éª¤ï¼š

#### 1. åˆ›å»ºFileController

é¦–å…ˆï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„æ§åˆ¶å™¨æ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼š

```java
package com.animesocial.platform.controller;

import com.animesocial.platform.model.dto.ApiResponse;
import com.animesocial.platform.util.FileStorageUtil;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import jakarta.servlet.http.HttpSession;
import java.io.IOException;
import java.util.HashMap;
import java.util.Map;

/**
 * æ–‡ä»¶ä¸Šä¼ æ§åˆ¶å™¨
 * å¤„ç†æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒåŒ…æ‹¬å¤´åƒã€èµ„æºå›¾ç‰‡ç­‰
 */
@RestController
@RequestMapping("/api")
public class FileController {
    
    @Autowired
    private FileStorageUtil fileStorageUtil;
    
    @Value("${app.file.domain}")
    private String fileDomain;
    
    /**
     * é€šç”¨æ–‡ä»¶ä¸Šä¼ æ¥å£
     * @param file ä¸Šä¼ çš„æ–‡ä»¶
     * @param type æ–‡ä»¶ç±»å‹ï¼ˆavatar: å¤´åƒï¼Œcover: å°é¢å›¾ï¼Œresource: èµ„æºæ–‡ä»¶ç­‰ï¼‰
     * @param session HTTPä¼šè¯
     * @return ä¸Šä¼ ç»“æœï¼ŒåŒ…å«æ–‡ä»¶URL
     */
    @PostMapping("/upload")
    public ApiResponse<Map<String, String>> uploadFile(
            @RequestParam("file") MultipartFile file,
            @RequestParam(value = "type", defaultValue = "common") String type,
            HttpSession session) {
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
        Integer userId = (Integer) session.getAttribute("userId");
        if (userId == null) {
            return ApiResponse.unauthorized();
        }
        
        // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
        if (file.isEmpty()) {
            return ApiResponse.validateFailed("è¯·é€‰æ‹©æ–‡ä»¶ä¸Šä¼ ");
        }
        
        try {
            // ä¿å­˜æ–‡ä»¶
            String fileName = fileStorageUtil.storeFile(file);
            String fileUrl = fileDomain + fileName;
            
            // è¿”å›æ–‡ä»¶URL
            Map<String, String> result = new HashMap<>();
            result.put("url", fileUrl);
            result.put("fileName", fileName);
            
            return ApiResponse.success("æ–‡ä»¶ä¸Šä¼ æˆåŠŸ", result);
        } catch (IOException e) {
            return ApiResponse.failed("æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage());
        }
    }
}
```

#### 2. ä¿®æ”¹Profile.vueä¸­çš„å¤´åƒä¸Šä¼ æ–¹å¼

å°†Profile.vueä¸­çš„å¤´åƒä¸Šä¼ ç»„ä»¶è¿›è¡Œè°ƒæ•´ï¼Œç¡®ä¿ä¸åç«¯æ¥å£åŒ¹é…ï¼š

```vue
<el-upload
  class="avatar-uploader"
  action="/api/upload"
  :headers="{ 'Content-Type': 'multipart/form-data' }"
  :data="{ type: 'avatar' }"
  :show-file-list="false"
  :on-success="handleAvatarSuccess"
  :before-upload="beforeAvatarUpload"
>
  <img v-if="editForm.avatar" :src="editForm.avatar" class="avatar" alt="ç”¨æˆ·å¤´åƒ" />
  <img v-else-if="userDetail.avatar" :src="userDetail.avatar" class="avatar" alt="ç”¨æˆ·å¤´åƒ" />
  <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon>
</el-upload>
```

#### 3. é…ç½®æ–‡ä»¶ä¸Šä¼ è·¯å¾„

ç¡®ä¿application.propertiesä¸­é…ç½®äº†æ­£ç¡®çš„æ–‡ä»¶ä¸Šä¼ è·¯å¾„ï¼š

```properties
# æ–‡ä»¶ä¸Šä¼ ç›®å½•é…ç½®
app.upload.dir=./uploads
# æ–‡ä»¶è®¿é—®åŸŸåé…ç½®
app.file.domain=http://localhost:8080/files/
```

#### 4. é…ç½®é™æ€èµ„æºè®¿é—®

ä¸ºäº†è®©ä¸Šä¼ çš„æ–‡ä»¶èƒ½å¤Ÿé€šè¿‡URLè®¿é—®ï¼Œéœ€è¦åœ¨WebConfigä¸­æ·»åŠ é™æ€èµ„æºæ˜ å°„ï¼š

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Value("${app.upload.dir}")
    private String uploadDir;
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // æ·»åŠ é™æ€èµ„æºæ˜ å°„ï¼Œä½¿ä¸Šä¼ çš„æ–‡ä»¶å¯é€šè¿‡URLè®¿é—®
        registry.addResourceHandler("/files/**")
                .addResourceLocations("file:" + uploadDir + "/");
    }
}
```

### ä½¿ç”¨è¯´æ˜

è¿™æ ·é…ç½®åï¼Œæ‚¨å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ï¼š

1. **ä¸Šä¼ ç”¨æˆ·å¤´åƒ**ï¼š
   åœ¨ç”¨æˆ·ä¸ªäººèµ„æ–™é¡µé¢ï¼Œç‚¹å‡»å¤´åƒåŒºåŸŸï¼Œé€‰æ‹©å›¾ç‰‡ä¸Šä¼ ã€‚ä¸Šä¼ æˆåŠŸåï¼Œç³»ç»Ÿä¼šè¿”å›å¤´åƒURLï¼Œç”¨æˆ·å¯ä»¥ä¿å­˜å¤´åƒæ›´æ–°ã€‚

2. **ä¸Šä¼ èµ„æºæ–‡ä»¶**ï¼š
   åœ¨èµ„æºä¸Šä¼ é¡µé¢ï¼Œåˆ†åˆ«ä¸Šä¼ å°é¢å›¾ç‰‡å’Œèµ„æºæ–‡ä»¶ã€‚è¿™äº›æ–‡ä»¶ä¼šè¢«ä¿å­˜åˆ°æœåŠ¡å™¨çš„uploadsç›®å½•ä¸­ï¼Œå¹¶ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼Œç„¶åè¿”å›å¯è®¿é—®çš„URLã€‚

3. **è®¿é—®ä¸Šä¼ çš„æ–‡ä»¶**ï¼š
   ä¸Šä¼ åçš„æ–‡ä»¶å¯ä»¥é€šè¿‡`http://localhost:8080/files/æ–‡ä»¶å`æ¥è®¿é—®ã€‚

### æ³¨æ„äº‹é¡¹

1. ä¸Šä¼ ç›®å½•æƒé™ï¼šç¡®ä¿æœåŠ¡å™¨ä¸Šçš„uploadsç›®å½•æœ‰è¯»å†™æƒé™
2. æ–‡ä»¶å¤§å°é™åˆ¶ï¼šåœ¨application.propertiesä¸­å·²é…ç½®äº†10MBçš„æ–‡ä»¶å¤§å°é™åˆ¶
3. å®‰å…¨æ€§ï¼šç”Ÿäº§ç¯å¢ƒä¸­åº”è€ƒè™‘æ›´ä¸¥æ ¼çš„æ–‡ä»¶ç±»å‹æ£€æŸ¥ã€æ–‡ä»¶æ‰«æç­‰å®‰å…¨æªæ–½
4. æ–‡ä»¶å­˜å‚¨ï¼šå¯¹äºå¤§è§„æ¨¡åº”ç”¨ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å¯¹è±¡å­˜å‚¨æœåŠ¡(å¦‚é˜¿é‡Œäº‘OSSã€ä¸ƒç‰›äº‘ç­‰)æ›¿ä»£æœ¬åœ°æ–‡ä»¶å­˜å‚¨

è¿™ä¸ªè§£å†³æ–¹æ¡ˆç¬¦åˆæ‚¨é¡¹ç›®çš„ç°æœ‰æ¶æ„ï¼Œå¹¶ä¸”ç®€å•æ˜“ç”¨ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤´åƒå’Œèµ„æºæ–‡ä»¶ä¸Šä¼ çš„éœ€æ±‚ã€‚

---

_**User**_

è¿™äº›æ–‡ä»¶æ˜¯ä»¥ä»€ä¹ˆå½¢å¼ä¿å­˜çš„ï¼Œæ˜¯urlå—ï¼Œæˆ‘çš„æ•°æ®åº“ @schema.sqlæ˜¯ä¿å­˜çš„url

---

_**Assistant**_

é€šè¿‡åˆ†æé¡¹ç›®ä»£ç å’Œschema.sqlï¼Œæˆ‘ç†è§£æ‚¨æƒ³äº†è§£ä¸Šä¼ æ–‡ä»¶æ˜¯å¦‚ä½•å­˜å‚¨çš„ã€‚

åœ¨å½“å‰é¡¹ç›®ä¸­ï¼Œæ–‡ä»¶å­˜å‚¨æ–¹å¼å¦‚ä¸‹ï¼š

1. **æ–‡ä»¶å®é™…å­˜å‚¨**ï¼š
   - æ–‡ä»¶è¢«ä¿å­˜åœ¨æœåŠ¡å™¨æœ¬åœ°çš„`./uploads`ç›®å½•ä¸‹
   - ä½¿ç”¨`FileStorageUtil`ç±»å¤„ç†æ–‡ä»¶å­˜å‚¨ï¼Œç”ŸæˆUUIDæ–‡ä»¶åé¿å…é‡å
   - ç³»ç»Ÿä¼šä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºå”¯ä¸€æ–‡ä»¶åï¼š`UUID + åŸæ–‡ä»¶æ‰©å±•å`

2. **æ•°æ®åº“ä¸­åªå­˜å‚¨URL**ï¼š
   - æ•°æ®åº“ä¸­ï¼ˆæ¯”å¦‚usersè¡¨çš„avatarå­—æ®µã€resourcesè¡¨çš„file_urlå­—æ®µï¼‰åªå­˜å‚¨æ–‡ä»¶çš„è®¿é—®URL
   - URLæ ¼å¼ä¸ºï¼š`http://localhost:8080/files/æ–‡ä»¶å`
   - å®é™…æ–‡ä»¶å†…å®¹ä¸å­˜å‚¨åœ¨æ•°æ®åº“ä¸­

3. **æ–‡ä»¶è®¿é—®æ–¹å¼**ï¼š
   - é€šè¿‡é…ç½®çš„åŸŸåè®¿é—®ï¼ˆ`app.file.domain` + æ–‡ä»¶åï¼‰
   - ç³»ç»Ÿé€šè¿‡é™æ€èµ„æºæ˜ å°„ï¼Œå°†URLè¯·æ±‚æ˜ å°„åˆ°å®é™…æ–‡ä»¶

è¿™ç§è®¾è®¡çš„å¥½å¤„æ˜¯ï¼š
- å‡è½»æ•°æ®åº“è´Ÿæ‹…ï¼Œé¿å…æ•°æ®åº“å­˜å‚¨å¤§é‡äºŒè¿›åˆ¶æ•°æ®
- æ–‡ä»¶è®¿é—®æ›´é«˜æ•ˆ
- ä¾¿äºåç»­è¿ç§»åˆ°äº‘å­˜å‚¨

è¦å®Œå–„æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½ï¼Œéœ€è¦åˆ›å»º`FileController`æä¾›ä¸Šä¼ æ¥å£ï¼Œå¹¶ç¡®ä¿æ­£ç¡®é…ç½®é™æ€èµ„æºæ˜ å°„ï¼Œè®©æ–‡ä»¶å¯ä»¥é€šè¿‡URLè®¿é—®ã€‚

å¦‚æœæ‚¨åç»­éœ€è¦æ‰©å±•ï¼Œå¯ä»¥è€ƒè™‘å°†å­˜å‚¨æ–¹å¼æ”¹ä¸ºäº‘å­˜å‚¨ï¼ˆå¦‚OSSï¼‰ï¼Œåªéœ€ä¿®æ”¹`FileStorageUtil`å®ç°ï¼Œè€Œä¸å½±å“å…¶ä»–ä»£ç ã€‚

---

_**User**_

è¯·æ‚¨æŒ‰ç…§å¤´åƒä¸èµ„æºåˆ†ç±»å¼€ï¼Œèµ„æºä¸‹é¢åˆæ ¹æ®æ–‡ä»¶ç±»å‹åˆ†ç±»å¼€ï¼Œå¸®æˆ‘å®Œæˆæ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆï¼Œè®°å¾—ä¿è¯ä»£ç ä¸€è‡´æ€§


---

_**Assistant**_

æˆ‘ä¼šä¸ºæ‚¨è®¾è®¡ä¸€ä¸ªå®Œå–„çš„æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆï¼ŒæŒ‰ç…§å¤´åƒä¸èµ„æºåˆ†ç±»ï¼Œå¹¶ä¸”èµ„æºæŒ‰ç…§æ–‡ä»¶ç±»å‹è¿›ä¸€æ­¥åˆ†ç±»ã€‚å…ˆè®©æˆ‘æŸ¥çœ‹ä¸€ä¸‹ç°æœ‰ä»£ç ä»¥ç¡®ä¿ä¸€è‡´æ€§ã€‚

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/util/FileStorageUtil.java

---

Read file: anime-social-platform/backend/src/main/resources/application.properties

---

ç°åœ¨æˆ‘éœ€è¦æŸ¥çœ‹é…ç½®ç±»ä»¥äº†è§£WebConfigå’Œå…¶ä»–ç›¸å…³é…ç½®ï¼š

---

<details>
            <summary>Searched codebase "WebConfig.java" â€¢ **2** results</summary>
        
| File |
|------|
| `undefined` |
| `undefined` |

</details>

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/config/WebConfig.java

---

ç°åœ¨æˆ‘å°†æŸ¥çœ‹`ResourceServiceImpl`ä»¥äº†è§£å½“å‰çš„èµ„æºä¸Šä¼ å®ç°æ–¹å¼ï¼š

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/service/impl/ResourceServiceImpl.java

---

Read file: anime-social-platform/backend/src/main/java/com/animesocial/platform/service/UserService.java

---

ç°åœ¨ï¼Œè®©æˆ‘åŸºäºæ‰€äº†è§£çš„é¡¹ç›®ç»“æ„ï¼Œè®¾è®¡ä¸€ä¸ªç¬¦åˆé¡¹ç›®éœ€æ±‚å’Œä»£ç é£æ ¼çš„æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆã€‚

---

```diff
  
      /**
-      * å­˜å‚¨æ–‡ä»¶
+      * å­˜å‚¨æ–‡ä»¶åˆ°é»˜è®¤ç›®å½•
       * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
       * @return å­˜å‚¨åçš„æ–‡ä»¶å
       * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
       */
      public String storeFile(MultipartFile file) throws IOException {
+         return storeFile(file, "");
+     }
+ 
+     /**
+      * æŒ‰ç…§ç±»å‹å­˜å‚¨æ–‡ä»¶åˆ°æŒ‡å®šå­ç›®å½•
+      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
+      * @param subDir å­ç›®å½•ï¼Œå¦‚avatar, resourceç­‰
+      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«å­ç›®å½•è·¯å¾„ï¼‰
+      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
+      */
+     public String storeFile(MultipartFile file, String subDir) throws IOException {
+         // æ„å»ºç›®æ ‡ç›®å½•è·¯å¾„
+         String targetDirPath = uploadDir;
+         if (subDir != null && !subDir.isEmpty()) {
+             targetDirPath = Paths.get(uploadDir, subDir).toString();
+         }
+         
          // æ£€æŸ¥ä¸Šä¼ ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
-         File uploadPath = new File(uploadDir);
+         File uploadPath = new File(targetDirPath);
          if (!uploadPath.exists()) {
              uploadPath.mkdirs();
          String fileName = UUID.randomUUID().toString() + extension;
          
-         // æ„å»ºæ–‡ä»¶è·¯å¾„
-         Path targetLocation = Paths.get(uploadDir, fileName);
+         // æ„å»ºæ–‡ä»¶ä¿å­˜è·¯å¾„
+         Path targetLocation = Paths.get(targetDirPath, fileName);
          
          // ä¿å­˜æ–‡ä»¶
          log.info("æ–‡ä»¶ {} ä¿å­˜è‡³ {}", originalFilename, targetLocation);
          
-         return fileName;
+         // è¿”å›åŒ…å«å­ç›®å½•çš„ç›¸å¯¹è·¯å¾„
+         return subDir.isEmpty() ? fileName : Paths.get(subDir, fileName).toString();
+     }
+     
+     /**
+      * æŒ‰ç…§æ–‡ä»¶ç±»å‹å­˜å‚¨èµ„æºæ–‡ä»¶
+      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
+      * @param fileType æ–‡ä»¶ç±»å‹ï¼Œå¦‚image, video, documentç­‰
+      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«åˆ†ç±»ç›®å½•è·¯å¾„ï¼‰
+      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
+      */
+     public String storeResourceFile(MultipartFile file, String fileType) throws IOException {
+         // èµ„æºæ–‡ä»¶é»˜è®¤å­˜å‚¨åœ¨resourcesç›®å½•ä¸‹ï¼Œå¹¶æŒ‰ç…§ç±»å‹è¿›ä¸€æ­¥åˆ†ç±»
+         String subDir = Paths.get("resources", fileType).toString();
+         return storeFile(file, subDir);
+     }
+     
+     /**
+      * å­˜å‚¨å¤´åƒæ–‡ä»¶
+      * @param file å¾…å­˜å‚¨çš„æ–‡ä»¶
+      * @return å­˜å‚¨åçš„æ–‡ä»¶åï¼ˆåŒ…å«å¤´åƒç›®å½•è·¯å¾„ï¼‰
+      * @throws IOException å¦‚æœå­˜å‚¨è¿‡ç¨‹ä¸­å‘ç”ŸIOé”™è¯¯
+      */
+     public String storeAvatarFile(MultipartFile file) throws IOException {
+         return storeFile(file, "avatars");
      }
      
      /**
       * åˆ é™¤æ–‡ä»¶
-      * @param fileName æ–‡ä»¶å
+      * @param filePath æ–‡ä»¶ç›¸å¯¹è·¯å¾„ï¼Œå¦‚avatars/xxx.jpg
       * @return æ˜¯å¦åˆ é™¤æˆåŠŸ
       */
-     public boolean deleteFile(String fileName) {
-         Path filePath = Paths.get(uploadDir, fileName);
+     public boolean deleteFile(String filePath) {
+         Path fullPath = Paths.get(uploadDir, filePath);
          try {
-             return Files.deleteIfExists(filePath);
+             return Files.deleteIfExists(fullPath);
          } catch (IOException e) {
-             log.error("åˆ é™¤æ–‡ä»¶å¤±è´¥: {}", filePath, e);
+             log.error("åˆ é™¤æ–‡ä»¶å¤±è´¥: {}", fullPath, e);
              return false;
          }
      /**
       * è·å–æ–‡ä»¶è·¯å¾„
-      * @param fileName æ–‡ä»¶å
+      * @param filePath æ–‡ä»¶ç›¸å¯¹è·¯å¾„
       * @return å®Œæ•´çš„æ–‡ä»¶è·¯å¾„
       */
-     public String getFilePath(String fileName) {
-         return Paths.get(uploadDir, fileName).toString();
+     public String getFilePath(String filePath) {
+         return Paths.get(uploadDir, filePath).toString();
+     }
+     
+     /**
+      * è·å–æ–‡ä»¶ç±»å‹
+      * @param filename åŸå§‹æ–‡ä»¶å
+      * @return æ–‡ä»¶ç±»å‹ï¼Œå¦‚image, video, documentç­‰
+      */
+     public String getFileType(String filename) {
+         if (filename == null || filename.isEmpty()) {
+             return "unknown";
+         }
+         
+         int dotIndex = filename.lastIndexOf('.');
+         if (dotIndex < 0) {
+             return "unknown";
+         }
+         
+         String extension = filename.substring(dotIndex + 1).toLowerCase();
+         
+         // ç®€å•çš„æ–‡ä»¶ç±»å‹åˆ¤æ–­
+         if (extension.matches("jpg|jpeg|png|gif|webp|bmp")) {
+             return "image";
+         } else if (extension.matches("mp4|avi|mov|wmv|flv|mkv")) {
+             return "video";
+         } else if (extension.matches("mp3|ogg|wav|flac|aac")) {
+             return "audio";
+         } else if (extension.matches("pdf|doc|docx|xls|xlsx|ppt|pptx|txt")) {
+             return "document";
+         } else if (extension.matches("zip|rar|7z|tar|gz")) {
+             return "archive";
+         }
+         
+         return extension;
      }
  } 
```

---

ç°åœ¨æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„FileControlleræ¥å¤„ç†æ–‡ä»¶ä¸Šä¼ ï¼š

---

```diff
- 
+ package com.animesocial.platform.controller;
+ 
+ import com.animesocial.platform.model.dto.ApiResponse;
+ import com.animesocial.platform.util.FileStorageUtil;
+ import org.springframework.beans.factory.annotation.Autowired;
+ import org.springframework.beans.factory.annotation.Value;
+ import org.springframework.web.bind.annotation.*;
+ import org.springframework.web.multipart.MultipartFile;
+ 
+ import jakarta.servlet.http.HttpSession;
+ import java.io.IOException;
+ import java.util.HashMap;
+ import java.util.Map;
+ 
+ /**
+  * æ–‡ä»¶ä¸Šä¼ æ§åˆ¶å™¨
+  * å¤„ç†æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼ŒåŒ…æ‹¬å¤´åƒã€å„ç±»èµ„æºæ–‡ä»¶ç­‰
+  */
+ @RestController
+ @RequestMapping("/api")
+ public class FileController {
+     
+     @Autowired
+     private FileStorageUtil fileStorageUtil;
+     
+     @Value("${app.file.domain}")
+     private String fileDomain;
+     
+     /**
+      * é€šç”¨æ–‡ä»¶ä¸Šä¼ æ¥å£
+      * æ ¹æ®æ–‡ä»¶ç±»å‹åˆ†åˆ«å­˜å‚¨åˆ°ä¸åŒç›®å½•
+      * 
+      * @param file ä¸Šä¼ çš„æ–‡ä»¶
+      * @param type æ–‡ä»¶ç±»å‹ï¼ˆavatar: å¤´åƒï¼Œresource: èµ„æºæ–‡ä»¶ç­‰ï¼‰
+      * @param session HTTPä¼šè¯
+      * @return ä¸Šä¼ ç»“æœï¼ŒåŒ…å«æ–‡ä»¶URL
+      */
+     @PostMapping("/upload")
+     public ApiResponse<Map<String, String>> uploadFile(
+             @RequestParam("file") MultipartFile file,
+             @RequestParam(value = "type", defaultValue = "common") String type,
+             HttpSession session) {
+         
+         // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
+         Integer userId = (Integer) session.getAttribute("userId");
+         if (userId == null) {
+             return ApiResponse.unauthorized();
+         }
+         
+         // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
+         if (file.isEmpty()) {
+             return ApiResponse.validateFailed("è¯·é€‰æ‹©æ–‡ä»¶ä¸Šä¼ ");
+         }
+         
+         try {
+             String storedFilePath;
+             String fileType = fileStorageUtil.getFileType(file.getOriginalFilename());
+             
+             // æ ¹æ®typeå‚æ•°å†³å®šå­˜å‚¨ä½ç½®
+             if ("avatar".equals(type)) {
+                 storedFilePath = fileStorageUtil.storeAvatarFile(file);
+             } else if ("resource".equals(type)) {
+                 storedFilePath = fileStorageUtil.storeResourceFile(file, fileType);
+             } else {
+                 // é€šç”¨æ–‡ä»¶å­˜å‚¨
+                 storedFilePath = fileStorageUtil.storeFile(file, "common");
+             }
+             
+             // æ„å»ºæ–‡ä»¶è®¿é—®URL
+             String fileUrl = fileDomain + "/files/" + storedFilePath;
+             
+             // è¿”å›æ–‡ä»¶URLå’Œç›¸å…³ä¿¡æ¯
+             Map<String, String> result = new HashMap<>();
+             result.put("url", fileUrl);
+             result.put("filePath", storedFilePath);
+             result.put("fileType", fileType);
+             result.put("originalFilename", file.getOriginalFilename());
+             
+             return ApiResponse.success("æ–‡ä»¶ä¸Šä¼ æˆåŠŸ", result);
+         } catch (IOException e) {
+             return ApiResponse.failed("æ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage());
+         }
+     }
+     
+     /**
+      * å¤´åƒä¸Šä¼ ä¸“ç”¨æ¥å£
+      * 
+      * @param file ä¸Šä¼ çš„å¤´åƒæ–‡ä»¶
+      * @param session HTTPä¼šè¯
+      * @return ä¸Šä¼ ç»“æœï¼ŒåŒ…å«å¤´åƒURL
+      */
+     @PostMapping("/upload/avatar")
+     public ApiResponse<Map<String, String>> uploadAvatar(
+             @RequestParam("file") MultipartFile file,
+             HttpSession session) {
+         
+         // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
+         Integer userId = (Integer) session.getAttribute("userId");
+         if (userId == null) {
+             return ApiResponse.unauthorized();
+         }
+         
+         // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
+         if (file.isEmpty()) {
+             return ApiResponse.validateFailed("è¯·é€‰æ‹©å¤´åƒå›¾ç‰‡ä¸Šä¼ ");
+         }
+         
+         // éªŒè¯æ˜¯å¦ä¸ºå›¾ç‰‡
+         String fileType = fileStorageUtil.getFileType(file.getOriginalFilename());
+         if (!"image".equals(fileType)) {
+             return ApiResponse.validateFailed("å¤´åƒå¿…é¡»æ˜¯å›¾ç‰‡æ ¼å¼ï¼ˆJPG/PNG/GIFç­‰ï¼‰");
+         }
+         
+         try {
+             // å­˜å‚¨å¤´åƒæ–‡ä»¶
+             String storedFilePath = fileStorageUtil.storeAvatarFile(file);
+             
+             // æ„å»ºå¤´åƒè®¿é—®URL
+             String fileUrl = fileDomain + "/files/" + storedFilePath;
+             
+             // è¿”å›å¤´åƒURL
+             Map<String, String> result = new HashMap<>();
+             result.put("url", fileUrl);
+             result.put("filePath", storedFilePath);
+             
+             return ApiResponse.success("å¤´åƒä¸Šä¼ æˆåŠŸ", result);
+         } catch (IOException e) {
+             return ApiResponse.failed("å¤´åƒä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage());
+         }
+     }
+     
+     /**
+      * èµ„æºæ–‡ä»¶ä¸Šä¼ ä¸“ç”¨æ¥å£
+      * 
+      * @param file ä¸Šä¼ çš„èµ„æºæ–‡ä»¶
+      * @param session HTTPä¼šè¯
+      * @return ä¸Šä¼ ç»“æœï¼ŒåŒ…å«èµ„æºæ–‡ä»¶URLå’Œç±»å‹
+      */
+     @PostMapping("/upload/resource")
+     public ApiResponse<Map<String, String>> uploadResourceFile(
+             @RequestParam("file") MultipartFile file,
+             HttpSession session) {
+         
+         // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
+         Integer userId = (Integer) session.getAttribute("userId");
+         if (userId == null) {
+             return ApiResponse.unauthorized();
+         }
+         
+         // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
+         if (file.isEmpty()) {
+             return ApiResponse.validateFailed("è¯·é€‰æ‹©èµ„æºæ–‡ä»¶ä¸Šä¼ ");
+         }
+         
+         try {
+             // è·å–æ–‡ä»¶ç±»å‹
+             String fileType = fileStorageUtil.getFileType(file.getOriginalFilename());
+             
+             // å­˜å‚¨èµ„æºæ–‡ä»¶
+             String storedFilePath = fileStorageUtil.storeResourceFile(file, fileType);
+             
+             // æ„å»ºèµ„æºæ–‡ä»¶è®¿é—®URL
+             String fileUrl = fileDomain + "/files/" + storedFilePath;
+             
+             // è¿”å›èµ„æºæ–‡ä»¶URLå’Œç›¸å…³ä¿¡æ¯
+             Map<String, String> result = new HashMap<>();
+             result.put("url", fileUrl);
+             result.put("filePath", storedFilePath);
+             result.put("fileType", fileType);
+             result.put("originalFilename", file.getOriginalFilename());
+             
+             return ApiResponse.success("èµ„æºæ–‡ä»¶ä¸Šä¼ æˆåŠŸ", result);
+         } catch (IOException e) {
+             return ApiResponse.failed("èµ„æºæ–‡ä»¶ä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage());
+         }
+     }
+     
+     /**
+      * èµ„æºå°é¢å›¾ä¸Šä¼ ä¸“ç”¨æ¥å£
+      * 
+      * @param file ä¸Šä¼ çš„å°é¢å›¾æ–‡ä»¶
+      * @param session HTTPä¼šè¯
+      * @return ä¸Šä¼ ç»“æœï¼ŒåŒ…å«å°é¢å›¾URL
+      */
+     @PostMapping("/upload/cover")
+     public ApiResponse<Map<String, String>> uploadCoverImage(
+             @RequestParam("file") MultipartFile file,
+             HttpSession session) {
+         
+         // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
+         Integer userId = (Integer) session.getAttribute("userId");
+         if (userId == null) {
+             return ApiResponse.unauthorized();
+         }
+         
+         // æ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºç©º
+         if (file.isEmpty()) {
+             return ApiResponse.validateFailed("è¯·é€‰æ‹©å°é¢å›¾ç‰‡ä¸Šä¼ ");
+         }
+         
+         // éªŒè¯æ˜¯å¦ä¸ºå›¾ç‰‡
+         String fileType = fileStorageUtil.getFileType(file.getOriginalFilename());
+         if (!"image".equals(fileType)) {
+             return ApiResponse.validateFailed("å°é¢å¿…é¡»æ˜¯å›¾ç‰‡æ ¼å¼ï¼ˆJPG/PNG/GIFç­‰ï¼‰");
+         }
+         
+         try {
+             // å­˜å‚¨å°é¢å›¾ç‰‡
+             String storedFilePath = fileStorageUtil.storeFile(file, "covers");
+             
+             // æ„å»ºå°é¢å›¾ç‰‡è®¿é—®URL
+             String fileUrl = fileDomain + "/files/" + storedFilePath;
+             
+             // è¿”å›å°é¢å›¾ç‰‡URL
+             Map<String, String> result = new HashMap<>();
+             result.put("url", fileUrl);
+             result.put("filePath", storedFilePath);
+             
+             return ApiResponse.success("å°é¢å›¾ç‰‡ä¸Šä¼ æˆåŠŸ", result);
+         } catch (IOException e) {
+             return ApiResponse.failed("å°é¢å›¾ç‰‡ä¸Šä¼ å¤±è´¥ï¼š" + e.getMessage());
+         }
+     }
+ } 
```

---

æ¥ä¸‹æ¥ï¼Œéœ€è¦ä¿®æ”¹WebConfigç±»ä»¥æ”¯æŒé™æ€èµ„æºè®¿é—®ï¼Œç¡®ä¿ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥è¢«è®¿é—®ï¼š

---

```diff
  package com.animesocial.platform.config;
  
+ import org.springframework.beans.factory.annotation.Value;
  import org.springframework.context.annotation.Configuration;
  import org.springframework.web.servlet.config.annotation.CorsRegistry;
+ import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
  import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;
  
   * è¯¥ç±»ç”¨äºé…ç½®Webç›¸å…³çš„è®¾ç½®ï¼ŒåŒ…æ‹¬ï¼š
   * 1. CORSï¼ˆè·¨åŸŸèµ„æºå…±äº«ï¼‰é…ç½®
-  * 2. å…¶ä»–Web MVCç›¸å…³é…ç½®
+  * 2. é™æ€èµ„æºæ˜ å°„é…ç½®
+  * 3. å…¶ä»–Web MVCç›¸å…³é…ç½®
   */
  @Configuration
  public class WebConfig implements WebMvcConfigurer {
+ 
+     @Value("${app.upload.dir}")
+     private String uploadDir;
  
      /**
                  .maxAge(3600); // é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’
      }
+     
+     /**
+      * é…ç½®é™æ€èµ„æºæ˜ å°„
+      * ä½¿ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥é€šè¿‡URLè®¿é—®
+      * 
+      * @param registry èµ„æºå¤„ç†å™¨æ³¨å†Œå™¨
+      */
+     @Override
+     public void addResourceHandlers(ResourceHandlerRegistry registry) {
+         // æ–‡ä»¶ä¸Šä¼ ç›®å½•æ˜ å°„ï¼Œä½¿ä¸Šä¼ çš„æ–‡ä»¶å¯é€šè¿‡/files/**è·¯å¾„è®¿é—®
+         registry.addResourceHandler("/files/**")
+                 .addResourceLocations("file:" + uploadDir + "/")
+                 .setCachePeriod(3600) // ç¼“å­˜1å°æ—¶
+                 .resourceChain(true);
+                 
+         // å¢åŠ Swagger-UIç›¸å…³é™æ€èµ„æºæ˜ å°„ï¼ˆå¦‚æœé¡¹ç›®ä½¿ç”¨ï¼‰
+         registry.addResourceHandler("/swagger-ui/**")
+                 .addResourceLocations("classpath:/META-INF/resources/webjars/springfox-swagger-ui/")
+                 .resourceChain(true);
+     }
  } 
```

---

ç°åœ¨æˆ‘ä»¬éœ€è¦æ›´æ–°ResourceServiceImplæ¥ä½¿ç”¨æ–°çš„æ–‡ä»¶å­˜å‚¨æ–¹æ³•ï¼š

---

```diff
              String originalFilename = file.getOriginalFilename();
              String fileType = getFileType(originalFilename);
-             String storedFileName = fileStorageUtil.storeFile(file);
-             String fileUrl = fileDomain + storedFileName;
+             
+             // ä½¿ç”¨æ–°çš„æ–¹æ³•æŒ‰ç…§ç±»å‹å­˜å‚¨èµ„æºæ–‡ä»¶
+             String storedFilePath = fileStorageUtil.storeResourceFile(file, fileType);
+             String fileUrl = fileDomain + "/files/" + storedFilePath;
              
              // åˆ›å»ºèµ„æºè®°å½•
```

---

æœ€åï¼Œéœ€è¦ç¡®ä¿application.propertiesä¸­çš„é…ç½®æ­£ç¡®ï¼š

---

```diff
  
  # File Upload
- spring.servlet.multipart.max-file-size=10MB
- spring.servlet.multipart.max-request-size=10MB
+ spring.servlet.multipart.max-file-size=50MB
+ spring.servlet.multipart.max-request-size=50MB
  
- # æ–‡ä»¶ä¸Šä¼ ç›®å½•é…ç½®ï¼ˆè¿™æ˜¯ç¼ºå¤±çš„é…ç½®ï¼‰anime-social-platform
+ # æ–‡ä»¶ä¸Šä¼ ç›®å½•é…ç½®
  app.upload.dir=./uploads
- # æ–‡ä»¶è®¿é—®åŸŸåé…ç½®
+ # æ–‡ä»¶è®¿é—®åŸŸåé…ç½®(ç¡®ä¿å°¾éƒ¨æ²¡æœ‰æ–œæ ï¼Œå› ä¸ºåœ¨æ„å»ºURLæ—¶ä¼šæ‰‹åŠ¨æ·»åŠ )
  app.file.domain=http://localhost:8080
  
```

---

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆçš„åç«¯éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬è¿›ä¸€æ­¥å®Œå–„å‰ç«¯çš„ä½¿ç”¨æ–¹å¼ã€‚æˆ‘ä»¬éœ€è¦ä¿®æ”¹é¡µé¢ä¸­çš„å¤´åƒä¸Šä¼ ç»„ä»¶ï¼Œä»¥ä½¿ç”¨æ–°åˆ›å»ºçš„æ¥å£ï¼š

---

Read file: anime-social-platform/frontend/src/views/Profile.vue

---

Read file: anime-social-platform/frontend/src/views/Profile.vue

---

è®©æˆ‘ä»¬ä¿®æ”¹Profile.vueä¸­çš„å¤´åƒä¸Šä¼ ç»„ä»¶ï¼š

---

```diff
                <el-upload
                  class="avatar-uploader"
-                 action="/api/upload"
+                 action="/api/upload/avatar"
+                 :headers="{'Content-Type': 'multipart/form-data'}"
                  :show-file-list="false"
                  :on-success="handleAvatarSuccess"
                  <el-icon v-else class="avatar-uploader-icon"><Plus /></el-icon>
                </el-upload>
+               <div class="upload-tip">æ”¯æŒjpgã€pngæ ¼å¼ï¼Œå¤§å°ä¸è¶…è¿‡2MB</div>
              </div>
  
    color: #333;
  }
+ 
+ .upload-tip {
+   margin-top: 10px;
+   font-size: 12px;
+   color: #909399;
+ }
  </style> 
```

---

ç°åœ¨ï¼Œè®©æˆ‘ä»¬æŸ¥çœ‹å¹¶ä¿®æ”¹ResourceUpload.vueä¸­çš„æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ï¼š

---

Read file: anime-social-platform/frontend/src/views/ResourceUpload.vue

---

Read file: anime-social-platform/frontend/src/views/ResourceUpload.vue

---

è®©æˆ‘ä»¬ä¿®æ”¹ResourceUpload.vueä¸­çš„æ–‡ä»¶ä¸Šä¼ å®ç°ï¼š

---

```diff
              <el-upload
                class="cover-uploader"
-               :http-request="uploadCoverRequest"
+               action="/api/upload/cover"
+               :headers="{'Content-Type': 'multipart/form-data'}"
                :show-file-list="false"
+               :on-success="handleCoverSuccess"
                :before-upload="beforeCoverUpload"
                accept="image/*"
              <el-upload
                class="resource-file-uploader"
-               :http-request="uploadResourceRequest"
+               action="/api/upload/resource"
+               :headers="{'Content-Type': 'multipart/form-data'}"
+               :on-success="handleResourceSuccess"
                :before-upload="beforeResourceUpload"
                :limit="1"
  };
  
- // è‡ªå®šä¹‰ä¸Šä¼ å°é¢å›¾ç‰‡è¯·æ±‚
- const uploadCoverRequest = (options: any) => {
-   const file = options.file;
-   resourceForm.coverFile = file;
-   
-   // åˆ›å»ºæœ¬åœ°é¢„è§ˆURL
-   coverImageUrl.value = URL.createObjectURL(file);
+ // æ”¹ä¸ºä½¿ç”¨on-successå¤„ç†å°é¢ä¸Šä¼ æˆåŠŸå›è°ƒ
+ const handleCoverSuccess = (response: any) => {
+   if (response.code === 200) {
+     resourceForm.coverFile = response.data.filePath;
+     coverImageUrl.value = response.data.url;
+     ElMessage.success('å°é¢ä¸Šä¼ æˆåŠŸ');
+   } else {
+     ElMessage.error(response.message || 'å°é¢ä¸Šä¼ å¤±è´¥');
+   }
  };
  
- // è‡ªå®šä¹‰ä¸Šä¼ èµ„æºæ–‡ä»¶è¯·æ±‚
- const uploadResourceRequest = (options: any) => {
-   const file = options.file;
-   resourceForm.resourceFile = file;
-   ElMessage.success(`èµ„æºæ–‡ä»¶ ${file.name} å·²é€‰æ‹©`);
+ // æ”¹ä¸ºä½¿ç”¨on-successå¤„ç†èµ„æºæ–‡ä»¶ä¸Šä¼ æˆåŠŸå›è°ƒ
+ const handleResourceSuccess = (response: any) => {
+   if (response.code === 200) {
+     resourceForm.resourceFile = response.data.filePath;
+     resourceForm.fileType = resourceForm.fileType || getResourceType(response.data.fileType);
+     ElMessage.success(`èµ„æºæ–‡ä»¶ ${response.data.originalFilename} ä¸Šä¼ æˆåŠŸ`);
+   } else {
+     ElMessage.error(response.message || 'èµ„æºæ–‡ä»¶ä¸Šä¼ å¤±è´¥');
+   }
+ };
+ 
+ // æ ¹æ®æ–‡ä»¶ç±»å‹æ¨èèµ„æºç±»å‹
+ const getResourceType = (fileType: string) => {
+   const typeMap: Record<string, string> = {
+     'video': 'åŠ¨ç”»',
+     'image': 'å£çº¸',
+     'audio': 'éŸ³ä¹',
+     'document': 'å°è¯´',
+     'archive': 'æ¼«ç”»'
+   };
+   return typeMap[fileType] || '';
  };
  
```

---

æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ›´æ–°èµ„æºä¸Šä¼ è¡¨å•æäº¤éƒ¨åˆ†ï¼Œä¿®æ”¹ä¸ºé€‚é…æ–°çš„æ–‡ä»¶ä¸Šä¼ æ–¹å¼ï¼š

---

```diff
        }
        
-       // æ·»åŠ æ–‡ä»¶
-       formData.append('file', resourceForm.resourceFile);
-       formData.append('coverImage', resourceForm.coverFile);
+       // æ·»åŠ æ–‡ä»¶è·¯å¾„ï¼ˆè€Œéæ–‡ä»¶æœ¬èº«ï¼Œå› ä¸ºæ–‡ä»¶å·²ç»ä¸Šä¼ ï¼‰
+       formData.append('filePath', resourceForm.resourceFile);
+       formData.append('coverPath', resourceForm.coverFile);
        
        // å‘é€è¯·æ±‚
-       const response = await resourceApi.uploadResource(formData);
+       const response = await resourceApi.createResource(formData);
        
        if (response.data.code === 200) {
-         ElMessage.success('èµ„æºä¸Šä¼ æˆåŠŸ!');
+         ElMessage.success('èµ„æºå‘å¸ƒæˆåŠŸ!');
          
          // ä¸Šä¼ æˆåŠŸåè·³è½¬åˆ°èµ„æºåˆ—è¡¨é¡µé¢
          }, 1500);
        } else {
-         ElMessage.error(response.data.message || 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•');
+         ElMessage.error(response.data.message || 'å‘å¸ƒå¤±è´¥ï¼Œè¯·é‡è¯•');
        }
      } catch (error: any) {
-       console.error('ä¸Šä¼ èµ„æºå‡ºé”™:', error);
-       ElMessage.error(error.response?.data?.message || 'ä¸Šä¼ å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
+       console.error('å‘å¸ƒèµ„æºå‡ºé”™:', error);
+       ElMessage.error(error.response?.data?.message || 'å‘å¸ƒå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
      } finally {
        submitting.value = false;
```

---

æˆ‘ä»¬éœ€è¦åœ¨resource.tsä¸­æ·»åŠ createResourceæ–¹æ³•ï¼š

---

Read file: anime-social-platform/frontend/src/api/resource.ts

---

```diff
    });
  };
+ 
+ /**
+  * åˆ›å»ºèµ„æºï¼ˆæ–‡ä»¶å·²ä¸Šä¼ ï¼‰
+  * @param formData åŒ…å«èµ„æºä¿¡æ¯çš„FormDataå¯¹è±¡ï¼ŒåŒ…æ‹¬æ–‡ä»¶è·¯å¾„
+  * @returns åˆ›å»ºç»“æœ
+  */
+ export const createResource = (formData: FormData) => {
+   return service.post<ApiResponse<Resource>>('/resources/create', formData, {
+     headers: {
+       'Content-Type': 'multipart/form-data'
+     }
+   });
+ };
  
  /**
```

---

æœ€åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨åç«¯åˆ›å»ºå¯¹åº”çš„æ¥å£å¤„ç†èµ„æºåˆ›å»ºï¼š

---

```diff
          }
      }
+ 
+     /**
+      * ä½¿ç”¨å·²ä¸Šä¼ çš„æ–‡ä»¶åˆ›å»ºèµ„æº
+      * @param title èµ„æºæ ‡é¢˜
+      * @param description èµ„æºæè¿°
+      * @param filePath å·²ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„
+      * @param coverPath å·²ä¸Šä¼ çš„å°é¢å›¾è·¯å¾„
+      * @param tagIds æ ‡ç­¾IDåˆ—è¡¨
+      * @param session HTTPä¼šè¯
+      * @return æ–°åˆ›å»ºçš„èµ„æºå¯¹è±¡
+      */
+     @PostMapping("/create")
+     public ApiResponse<ResourceDTO> createResource(
+             @RequestParam String title,
+             @RequestParam(required = false) String description,
+             @RequestParam String filePath,
+             @RequestParam String coverPath,
+             @RequestParam(required = false) List<Integer> tagIds,
+             HttpSession session) {
+         // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
+         Integer userId = (Integer) session.getAttribute("userId");
+         if (userId == null) {
+             return ApiResponse.unauthorized();
+         }
+         
+         try {
+             ResourceDTO resource = resourceService.createResource(userId, title, description, filePath, coverPath, tagIds);
+             return ApiResponse.success("èµ„æºåˆ›å»ºæˆåŠŸ", resource);
+         } catch (Exception e) {
+             return ApiResponse.failed(e.getMessage());
+         }
+     }
  } 
```

---

ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ResourceServiceæ¥å£å’Œå®ç°ç±»ä¸­æ·»åŠ createResourceæ–¹æ³•ï¼š

---

```diff
       */
      ResourceListResponse getLikedResources(Integer userId, Integer page, Integer size);
+     
+     /**
+      * ä½¿ç”¨å·²ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„åˆ›å»ºèµ„æº
+      * @param userId ç”¨æˆ·ID
+      * @param title èµ„æºæ ‡é¢˜
+      * @param description èµ„æºæè¿°
+      * @param filePath å·²ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„
+      * @param coverPath å·²ä¸Šä¼ çš„å°é¢å›¾è·¯å¾„
+      * @param tagIds æ ‡ç­¾IDåˆ—è¡¨
+      * @return åˆ›å»ºçš„èµ„æºDTO
+      */
+     ResourceDTO createResource(Integer userId, String title, String description, String filePath, String coverPath, List<Integer> tagIds);
  } 
```

---



---

```diff
          return new ResourceListResponse(dtoList, total);
      }
+ 
+     /**
+      * ä½¿ç”¨å·²ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„åˆ›å»ºèµ„æº
+      * @param userId ç”¨æˆ·ID
+      * @param title èµ„æºæ ‡é¢˜
+      * @param description èµ„æºæè¿°
+      * @param filePath å·²ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„
+      * @param coverPath å·²ä¸Šä¼ çš„å°é¢å›¾è·¯å¾„
+      * @param tagIds æ ‡ç­¾IDåˆ—è¡¨
+      * @return åˆ›å»ºçš„èµ„æºDTO
+      */
+     @Override
+     @Transactional
+     public ResourceDTO createResource(Integer userId, String title, String description, 
+                                      String filePath, String coverPath, List<Integer> tagIds) {
+         // éªŒè¯ç”¨æˆ·
+         User user = userRepository.findById(userId);
+         if (user == null) {
+             throw new BusinessException("ç”¨æˆ·ä¸å­˜åœ¨");
+         }
+         
+         // éªŒè¯è·¯å¾„
+         if (filePath == null || filePath.isEmpty()) {
+             throw new BusinessException("æ–‡ä»¶è·¯å¾„ä¸èƒ½ä¸ºç©º");
+         }
+         
+         if (coverPath == null || coverPath.isEmpty()) {
+             throw new BusinessException("å°é¢å›¾è·¯å¾„ä¸èƒ½ä¸ºç©º");
+         }
+         
+         try {
+             // è·å–æ–‡ä»¶ç±»å‹
+             String fileType = getFileTypeFromPath(filePath);
+             // è·å–æ–‡ä»¶å¤§å°ï¼ˆè¿™é‡Œä½¿ç”¨ä¼°è®¡å€¼ï¼Œå› ä¸ºæ–‡ä»¶å·²ä¸Šä¼ ï¼‰
+             int fileSize = 1024; // é»˜è®¤1MB
+             
+             // æ„å»ºå®Œæ•´çš„URL
+             String fileUrl = fileDomain + "/files/" + filePath;
+             String coverUrl = fileDomain + "/files/" + coverPath;
+             
+             // åˆ›å»ºèµ„æºè®°å½•
+             Resource resource = new Resource();
+             resource.setUserId(userId);
+             resource.setTitle(title);
+             resource.setDescription(description);
+             resource.setFileUrl(fileUrl);
+             resource.setFileType(fileType);
+             resource.setFileSize(fileSize); // è®¾ç½®ä¸ºä¼°è®¡å€¼
+             resource.setUploadTime(LocalDateTime.now());
+             resource.setDownloadCount(0);
+             resource.setLikeCount(0);
+             
+             // ä¿å­˜èµ„æº
+             resourceRepository.insert(resource);
+             
+             // å¤„ç†æ ‡ç­¾
+             if (tagIds != null && !tagIds.isEmpty()) {
+                 tagService.updateResourceTags(resource.getId(), tagIds);
+             }
+             
+             // è½¬æ¢ä¸ºDTO
+             ResourceDTO dto = convertToDTO(resource);
+             dto.setUsername(user.getUsername());
+             dto.setUserAvatar(user.getAvatar());
+             
+             if (tagIds != null && !tagIds.isEmpty()) {
+                 dto.setTags(tagService.getResourceTags(resource.getId()));
+             } else {
+                 dto.setTags(new ArrayList<>());
+             }
+             
+             return dto;
+             
+         } catch (Exception e) {
+             log.error("åˆ›å»ºèµ„æºå¤±è´¥", e);
+             throw new BusinessException("åˆ›å»ºèµ„æºå¤±è´¥: " + e.getMessage());
+         }
+     }
+     
+     /**
+      * æ ¹æ®æ–‡ä»¶è·¯å¾„è·å–æ–‡ä»¶ç±»å‹
+      * @param filePath æ–‡ä»¶è·¯å¾„
+      * @return æ–‡ä»¶ç±»å‹
+      */
+     private String getFileTypeFromPath(String filePath) {
+         // æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦åŒ…å«ç±»å‹ä¿¡æ¯
+         if (filePath.contains("resources/")) {
+             String[] parts = filePath.split("/");
+             if (parts.length >= 2) {
+                 for (int i = 0; i < parts.length - 1; i++) {
+                     if ("resources".equals(parts[i]) && i + 1 < parts.length) {
+                         return parts[i + 1];
+                     }
+                 }
+             }
+         }
+         
+         // å¦‚æœè·¯å¾„ä¸­æ²¡æœ‰ç±»å‹ä¿¡æ¯ï¼Œå°è¯•ä»æ–‡ä»¶ååˆ¤æ–­
+         return getFileType(filePath);
+     }
  } 
```

---

ç°åœ¨æˆ‘ä»¬å·²ç»å®Œæˆäº†æ‰€æœ‰å¿…è¦çš„ä»£ç ä¿®æ”¹ï¼Œæ€»ç»“ä¸€ä¸‹æˆ‘ä»¬çš„æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆï¼š

### æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆæ€»ç»“

æˆ‘ä»¬è®¾è®¡å¹¶å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„æ–‡ä»¶ä¸Šä¼ è§£å†³æ–¹æ¡ˆï¼Œèƒ½å¤Ÿæ»¡è¶³åŠ¨æ¼«ç¤¾äº¤å¹³å°å¯¹äºå¤´åƒä¸Šä¼ å’Œèµ„æºæ–‡ä»¶ä¸Šä¼ çš„éœ€æ±‚ï¼š

#### 1. åç«¯å®ç°

1. **æ–‡ä»¶å­˜å‚¨å·¥å…·ç±» (FileStorageUtil)**
   - æˆ‘ä»¬æ‰©å±•äº†ç°æœ‰çš„FileStorageUtilç±»ï¼Œå¢åŠ äº†æŒ‰ç±»å‹åˆ†ç±»å­˜å‚¨æ–‡ä»¶çš„åŠŸèƒ½
   - ä¸ºå¤´åƒæ–‡ä»¶å’Œèµ„æºæ–‡ä»¶æä¾›äº†ä¸“é—¨çš„å­˜å‚¨æ–¹æ³•
   - èµ„æºæ–‡ä»¶æŒ‰ç±»å‹ï¼ˆå›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€æ–‡æ¡£ç­‰ï¼‰è¿›ä¸€æ­¥åˆ†ç±»å­˜å‚¨

2. **æ–‡ä»¶ä¸Šä¼ æ§åˆ¶å™¨ (FileController)**
   - åˆ›å»ºäº†ä¸“é—¨çš„FileControllerå¤„ç†æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ è¯·æ±‚
   - æä¾›äº†é€šç”¨çš„ä¸Šä¼ æ¥å£(/api/upload)ï¼Œä»¥åŠé’ˆå¯¹å¤´åƒ(/api/upload/avatar)ã€èµ„æºæ–‡ä»¶(/api/upload/resource)å’Œå°é¢å›¾(/api/upload/cover)çš„ä¸“ç”¨æ¥å£
   - æ‰€æœ‰ä¸Šä¼ æ¥å£éƒ½è¿”å›æ ‡å‡†çš„ApiResponseæ ¼å¼ï¼ŒåŒ…å«æ–‡ä»¶URLç­‰ä¿¡æ¯

3. **é™æ€èµ„æºæ˜ å°„ (WebConfig)**
   - ä¿®æ”¹äº†WebConfigç±»ï¼Œå¢åŠ äº†é™æ€èµ„æºæ˜ å°„é…ç½®
   - ä½¿ä¸Šä¼ çš„æ–‡ä»¶å¯ä»¥é€šè¿‡URLç›´æ¥è®¿é—®ï¼š/files/...

4. **èµ„æºåˆ›å»ºæ¥å£ (ResourceController)**
   - å¢åŠ äº†createResourceæ¥å£ï¼Œç”¨äºåœ¨æ–‡ä»¶ä¸Šä¼ ååˆ›å»ºèµ„æºè®°å½•
   - ä½¿ç”¨å·²ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„ï¼Œè€Œä¸å†éœ€è¦é‡å¤ä¸Šä¼ æ–‡ä»¶

#### 2. å‰ç«¯å®ç°

1. **å¤´åƒä¸Šä¼ ç»„ä»¶**
   - ä¿®æ”¹äº†Profile.vueä¸­çš„å¤´åƒä¸Šä¼ ç»„ä»¶ï¼Œä½¿ç”¨æ–°çš„ä¸“ç”¨æ¥å£
   - æ·»åŠ äº†å¿…è¦çš„è¯·æ±‚å¤´å’Œæç¤ºä¿¡æ¯

2. **èµ„æºä¸Šä¼ ç»„ä»¶**
   - ä¿®æ”¹äº†ResourceUpload.vueä¸­çš„æ–‡ä»¶ä¸Šä¼ å®ç°
   - å°†è‡ªå®šä¹‰http-requestæ”¹ä¸ºä½¿ç”¨actionå’Œon-successå›è°ƒ
   - åˆ†ç¦»äº†æ–‡ä»¶ä¸Šä¼ å’Œèµ„æºåˆ›å»ºçš„æµç¨‹ï¼šå…ˆä¸Šä¼ æ–‡ä»¶è·å–è·¯å¾„ï¼Œå†åˆ›å»ºèµ„æºè®°å½•

3. **APIæ–¹æ³•**
   - åœ¨resource.tsä¸­æ–°å¢äº†createResourceæ–¹æ³•ï¼Œç”¨äºåœ¨æ–‡ä»¶ä¸Šä¼ ååˆ›å»ºèµ„æºè®°å½•

#### 3. æ–‡ä»¶ç»„ç»‡ç»“æ„

æ–‡ä»¶åœ¨æœåŠ¡å™¨ä¸ŠæŒ‰ä»¥ä¸‹ç»“æ„ç»„ç»‡ï¼š
- `./uploads/`ï¼ˆæ ¹ç›®å½•ï¼‰
  - `avatars/`ï¼ˆå­˜å‚¨ç”¨æˆ·å¤´åƒï¼‰
  - `covers/`ï¼ˆå­˜å‚¨èµ„æºå°é¢å›¾ï¼‰
  - `resources/`ï¼ˆå­˜å‚¨èµ„æºæ–‡ä»¶ï¼‰
    - `image/`ï¼ˆå›¾ç‰‡ç±»èµ„æºï¼‰
    - `video/`ï¼ˆè§†é¢‘ç±»èµ„æºï¼‰
    - `audio/`ï¼ˆéŸ³é¢‘ç±»èµ„æºï¼‰
    - `document/`ï¼ˆæ–‡æ¡£ç±»èµ„æºï¼‰
    - `archive/`ï¼ˆå‹ç¼©åŒ…ç±»èµ„æºï¼‰
  - `common/`ï¼ˆå…¶ä»–é€šç”¨æ–‡ä»¶ï¼‰

#### 4. é…ç½®è°ƒæ•´

- å°†æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶ä»10MBæå‡åˆ°50MBï¼Œé€‚åº”æ›´å¤§çš„èµ„æºæ–‡ä»¶
- åœ¨é…ç½®ä¸­æ˜ç¡®æŒ‡å®šäº†æ–‡ä»¶åŸŸåå’Œä¸Šä¼ ç›®å½•

è¿™ä¸ªè§£å†³æ–¹æ¡ˆç¬¦åˆå½“å‰é¡¹ç›®çš„æ¶æ„å’Œä»£ç é£æ ¼ï¼Œæä¾›äº†ä¸€ä¸ªç®€å•ã€æ¸…æ™°ä¸”å¯æ‰©å±•çš„æ–‡ä»¶ä¸Šä¼ æœºåˆ¶ï¼Œèƒ½å¤Ÿæ»¡è¶³å¤´åƒä¸Šä¼ å’Œä¸åŒç±»å‹èµ„æºæ–‡ä»¶ä¸Šä¼ çš„éœ€æ±‚ã€‚

---

_**User**_

element-plus.js:62938 
 
 POST http://localhost:5173/api/upload/avatar 404 (Not Found)
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237
element-plus.js:63562 
 UploadAjaxError: fail to post /api/upload/avatar 404
    at getError (element-plus.js:62880:10)
    at XMLHttpRequest.<anonymous> (element-plus.js:62920:29)
handleError	@	element-plus.js:63562
onError	@	element-plus.js:63456
(åŒ¿å)	@	element-plus.js:62920
XMLHttpRequest.send		
ajaxUpload	@	element-plus.js:62938
doUpload	@	element-plus.js:63460
await in doUpload		
upload	@	element-plus.js:63410
await in upload		
uploadFiles	@	element-plus.js:63375
handleChange	@	element-plus.js:63470
callWithErrorHandling	@	chunk-2D2MXNFE.js:2300
callWithAsyncErrorHandling	@	chunk-2D2MXNFE.js:2307
invoker	@	chunk-2D2MXNFE.js:11237

å‡ºé”™äº†

---

_**Assistant**_

æˆ‘çœ‹åˆ°æ‚¨åœ¨ä½¿ç”¨ä¸Šä¼ å¤´åƒåŠŸèƒ½æ—¶é‡åˆ°äº†404é”™è¯¯ã€‚è¿™ä¸ªé”™è¯¯è¡¨æ˜æœåŠ¡å™¨æ‰¾ä¸åˆ°`/api/upload/avatar`è¿™ä¸ªæ¥å£è·¯å¾„ã€‚

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åˆ›å»ºäº†`FileController.java`æ–‡ä»¶ï¼Œä½†æ˜¯å¼€å‘æœåŠ¡å™¨å¯èƒ½æ²¡æœ‰é‡æ–°åŠ è½½æˆ–è€…è·¯å¾„é…ç½®æœ‰é—®é¢˜ã€‚

è®©æˆ‘ä»¬æ£€æŸ¥å¹¶ä¿®å¤è¿™ä¸ªé—®é¢˜ï¼š

---

```bash
cd anime-social-platform/backend && mvn spring-boot:run
```

---

çœ‹èµ·æ¥åç«¯æœåŠ¡å™¨æ²¡æœ‰å¯åŠ¨ã€‚è®©æˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ä¸€ä¸‹å‰ç«¯å¼€å‘æœåŠ¡å™¨çš„ä»£ç†é…ç½®ï¼Œç¡®ä¿å®ƒèƒ½æ­£ç¡®åœ°å°†APIè¯·æ±‚è½¬å‘åˆ°åç«¯ï¼š

---

Read file: anime-social-platform/frontend/vite.config.ts

---

æˆ‘å‘ç°å‰ç«¯çš„Viteé…ç½®ä¸­æ²¡æœ‰è®¾ç½®ä»£ç†ã€‚è¿™æ„å‘³ç€å½“å‰å‰ç«¯è¯·æ±‚`/api/`è·¯å¾„æ—¶ï¼Œè¯·æ±‚ä¼šå‘é€åˆ°å‰ç«¯æœåŠ¡å™¨è€Œä¸æ˜¯åç«¯æœåŠ¡å™¨ï¼Œå› æ­¤ä¼šæ”¶åˆ°404é”™è¯¯ã€‚

æˆ‘ä»¬éœ€è¦åšä»¥ä¸‹å‡ ä¸ªä¿®æ”¹ï¼š

1. ä¿®æ”¹å‰ç«¯çš„ä»£ç†é…ç½®ï¼Œå°†APIè¯·æ±‚è½¬å‘åˆ°åç«¯
2. ç¡®ä¿åç«¯æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ

è®©æˆ‘ä»¬å…ˆä¿®æ”¹å‰ç«¯çš„Viteé…ç½®ï¼š

---



---



---



---

